<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Loose Coupling Refactoring Summary - Project Kraken 0.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-brand-primary: #7C3AED;
  --color-brand-content: #7C3AED;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #A78BFA;
  --color-brand-content: #A78BFA;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #A78BFA;
  --color-brand-content: #A78BFA;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Project Kraken 0.4.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <span class="sidebar-brand-text">Project Kraken 0.4.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Projekt Kraken</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WIKI_LINKING.html">ID-Based Wiki Linking Implementation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MAP_USAGE_EXAMPLES.html">Map System Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LONGFORM.html">Longform Document Feature</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Design.html">Project Kraken: Comprehensive Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DATABASE.html">Database Architecture and Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DEVELOPMENT.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SCHEMA_REFERENCE.html">Database Schema Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SECURITY.html">Security Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../SEMANTIC_SEARCH.html">Semantic Search in ProjektKraken</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LLM_INTEGRATION.html">Multi-Provider LLM Integration Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../TAG_MIGRATION_GUIDE.html">Tag Normalization Migration Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">src</a><input aria-label="Toggle navigation of src" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../app.html">app package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html">cli package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html">commands package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core.html">core package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../gui.html">gui package</a><input aria-label="Toggle navigation of gui package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../gui.widgets.html">gui.widgets package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gui.dialogs.html">gui.dialogs package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services.html">services package</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/archive/REFACTORING_SUMMARY.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="loose-coupling-refactoring-summary">
<h1>Loose Coupling Refactoring Summary<a class="headerlink" href="#loose-coupling-refactoring-summary" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This refactoring addresses architectural violations identified in the codebase analysis by introducing loose coupling through signals, callbacks, and protocol interfaces.</p>
</section>
<section id="problems-addressed">
<h2>Problems Addressed<a class="headerlink" href="#problems-addressed" title="Link to this heading">¶</a></h2>
<section id="datahandler-mainwindow-tight-coupling-resolved">
<h3>1. DataHandler → MainWindow Tight Coupling ✅ RESOLVED<a class="headerlink" href="#datahandler-mainwindow-tight-coupling-resolved" title="Link to this heading">¶</a></h3>
<p><strong>Problem:</strong> DataHandler directly accessed MainWindow’s internal widgets and attributes via <code class="docutils literal notranslate"><span class="pre">self.window</span></code>, violating the Law of Demeter.</p>
<p><strong>Solution:</strong></p>
<ul class="simple">
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">main_window</span></code> parameter from DataHandler constructor</p></li>
<li><p>Introduced 15+ signals for different UI update scenarios</p></li>
<li><p>MainWindow now connects to signals and updates itself</p></li>
<li><p>DataHandler maintains its own cache instead of accessing MainWindow’s cache</p></li>
</ul>
<p><strong>Benefits:</strong></p>
<ul class="simple">
<li><p>DataHandler is now testable in isolation</p></li>
<li><p>No direct widget manipulation from service layer</p></li>
<li><p>Clear separation of concerns</p></li>
</ul>
</section>
<section id="timelinewidget-databaseservice-layer-violation-resolved">
<h3>2. TimelineWidget → DatabaseService Layer Violation ✅ RESOLVED<a class="headerlink" href="#timelinewidget-databaseservice-layer-violation-resolved" title="Link to this heading">¶</a></h3>
<p><strong>Problem:</strong> TimelineView and GroupBandManager directly accessed DatabaseService, bypassing the Command/Controller layer.</p>
<p><strong>Solution:</strong></p>
<ul class="simple">
<li><p>Replaced <code class="docutils literal notranslate"><span class="pre">set_db_service()</span></code> with <code class="docutils literal notranslate"><span class="pre">set_data_provider()</span></code> in TimelineView</p></li>
<li><p>GroupBandManager now uses callback functions instead of db_service</p></li>
<li><p>MainWindow implements data provider interface</p></li>
<li><p>Timeline requests data via callbacks, MainWindow mediates</p></li>
</ul>
<p><strong>Benefits:</strong></p>
<ul class="simple">
<li><p>UI layer no longer bypasses architectural boundaries</p></li>
<li><p>Timeline is decoupled from specific database implementation</p></li>
<li><p>MainWindow acts as proper mediator between layers</p></li>
</ul>
</section>
<section id="uimanager-mainwindow-implicit-interface-resolved">
<h3>3. UIManager → MainWindow Implicit Interface ✅ RESOLVED<a class="headerlink" href="#uimanager-mainwindow-implicit-interface-resolved" title="Link to this heading">¶</a></h3>
<p><strong>Problem:</strong> UIManager assumed specific methods existed on MainWindow without a formal contract.</p>
<p><strong>Solution:</strong></p>
<ul class="simple">
<li><p>Created <code class="docutils literal notranslate"><span class="pre">MainWindowProtocol</span></code> in <code class="docutils literal notranslate"><span class="pre">src/core/protocols.py</span></code></p></li>
<li><p>Added type hint to UIManager constructor: <code class="docutils literal notranslate"><span class="pre">MainWindowProtocol</span></code></p></li>
<li><p>Interface is now explicit and runtime-checkable</p></li>
</ul>
<p><strong>Benefits:</strong></p>
<ul class="simple">
<li><p>Contract is clear and verifiable</p></li>
<li><p>Type checkers can catch interface violations</p></li>
<li><p>Better documentation of dependencies</p></li>
</ul>
</section>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="new-files-created">
<h3>New Files Created<a class="headerlink" href="#new-files-created" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">src/core/protocols.py</span></code></strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MainWindowProtocol</span></code>: Defines interface for UIManager</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TimelineDataProvider</span></code>: Defines interface for timeline data access</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tests/unit/test_protocols.py</span></code></strong></p>
<ul class="simple">
<li><p>Tests protocol validation</p></li>
<li><p>Ensures structural subtyping works correctly</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tests/unit/test_data_handler.py</span></code></strong></p>
<ul class="simple">
<li><p>Tests DataHandler signal emissions</p></li>
<li><p>Verifies decoupling from MainWindow</p></li>
</ul>
</li>
</ol>
</section>
<section id="files-modified">
<h3>Files Modified<a class="headerlink" href="#files-modified" title="Link to this heading">¶</a></h3>
<section id="src-app-data-handler-py">
<h4>src/app/data_handler.py<a class="headerlink" href="#src-app-data-handler-py" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Removed MainWindow reference</p></li>
<li><p>Added 15+ signals for UI updates</p></li>
<li><p>Maintains own cache of events/entities</p></li>
<li><p>Emits signals instead of direct widget access</p></li>
</ul>
</section>
<section id="src-app-main-py-mainwindow">
<h4>src/app/main.py (MainWindow)<a class="headerlink" href="#src-app-main-py-mainwindow" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Added signal handler slots for DataHandler signals</p></li>
<li><p>Implements TimelineDataProvider interface</p></li>
<li><p>Acts as data provider for Timeline</p></li>
<li><p>Connects DataHandler signals via ConnectionManager</p></li>
</ul>
</section>
<section id="src-app-connection-manager-py">
<h4>src/app/connection_manager.py<a class="headerlink" href="#src-app-connection-manager-py" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Added <code class="docutils literal notranslate"><span class="pre">connect_data_handler()</span></code> method</p></li>
<li><p>Wires up all DataHandler signals to MainWindow slots</p></li>
</ul>
</section>
<section id="src-app-ui-manager-py">
<h4>src/app/ui_manager.py<a class="headerlink" href="#src-app-ui-manager-py" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Updated constructor type hint to <code class="docutils literal notranslate"><span class="pre">MainWindowProtocol</span></code></p></li>
<li><p>Made interface contract explicit</p></li>
</ul>
</section>
<section id="src-gui-widgets-timeline-timeline-view-py">
<h4>src/gui/widgets/timeline/timeline_view.py<a class="headerlink" href="#src-gui-widgets-timeline-timeline-view-py" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Replaced <code class="docutils literal notranslate"><span class="pre">set_db_service()</span></code> with <code class="docutils literal notranslate"><span class="pre">set_data_provider()</span></code></p></li>
<li><p>Removed direct database access</p></li>
<li><p>Uses data provider interface</p></li>
</ul>
</section>
<section id="src-gui-widgets-timeline-group-band-manager-py">
<h4>src/gui/widgets/timeline/group_band_manager.py<a class="headerlink" href="#src-gui-widgets-timeline-group-band-manager-py" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Replaced <code class="docutils literal notranslate"><span class="pre">db_service</span></code> with callback functions</p></li>
<li><p>Constructor now takes callback parameters</p></li>
<li><p>No direct database access</p></li>
</ul>
</section>
<section id="src-gui-widgets-timeline-init-py">
<h4>src/gui/widgets/timeline/<strong>init</strong>.py<a class="headerlink" href="#src-gui-widgets-timeline-init-py" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Added <code class="docutils literal notranslate"><span class="pre">set_data_provider()</span></code> wrapper method</p></li>
</ul>
</section>
</section>
</section>
<section id="architectural-improvements">
<h2>Architectural Improvements<a class="headerlink" href="#architectural-improvements" title="Link to this heading">¶</a></h2>
<section id="before">
<h3>Before<a class="headerlink" href="#before" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌──────────────┐
│ DataHandler  │──────&gt; MainWindow.unified_list
│              │──────&gt; MainWindow.timeline
│              │──────&gt; MainWindow.event_editor
│              │──────&gt; MainWindow._cached_events
└──────────────┘       (Direct attribute access)

┌──────────────┐
│ TimelineView │──────&gt; DatabaseService
│              │        (Layer violation)
└──────────────┘

┌──────────────┐
│ UIManager    │──────&gt; MainWindow methods (implicit)
└──────────────┘
</pre></div>
</div>
</section>
<section id="after">
<h3>After<a class="headerlink" href="#after" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌──────────────┐     signals      ┌──────────────┐
│ DataHandler  │─────────────────&gt;│  MainWindow  │
│              │                   │  (connects)  │
└──────────────┘                   └──────────────┘

┌──────────────┐   callbacks    ┌──────────────┐
│ TimelineView │&lt;───────────────│  MainWindow  │
│              │  (data provider)│ (implements) │
└──────────────┘                 └──────────────┘

┌──────────────┐     Protocol   ┌──────────────┐
│ UIManager    │─────────────────&gt;│  MainWindow  │
│              │   (type hint)   │ (implements) │
└──────────────┘                 └──────────────┘
</pre></div>
</div>
</section>
</section>
<section id="design-patterns-used">
<h2>Design Patterns Used<a class="headerlink" href="#design-patterns-used" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p><strong>Observer Pattern (Signals/Slots)</strong></p>
<ul class="simple">
<li><p>DataHandler emits signals</p></li>
<li><p>MainWindow observes and reacts</p></li>
<li><p>Loose coupling through Qt’s signal system</p></li>
</ul>
</li>
<li><p><strong>Callback Pattern</strong></p>
<ul class="simple">
<li><p>GroupBandManager receives callbacks</p></li>
<li><p>Doesn’t know about data source</p></li>
<li><p>Just calls provided functions</p></li>
</ul>
</li>
<li><p><strong>Protocol Pattern (PEP 544)</strong></p>
<ul class="simple">
<li><p>Structural subtyping</p></li>
<li><p>Runtime-checkable interfaces</p></li>
<li><p>No inheritance required</p></li>
</ul>
</li>
<li><p><strong>Mediator Pattern</strong></p>
<ul class="simple">
<li><p>MainWindow mediates between Timeline and Database</p></li>
<li><p>Prevents direct UI → Database coupling</p></li>
</ul>
</li>
</ol>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h2>
<section id="new-tests">
<h3>New Tests<a class="headerlink" href="#new-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>test_protocols.py</strong>: Validates protocol interfaces work correctly</p></li>
<li><p><strong>test_data_handler.py</strong>: Tests signal-based DataHandler</p></li>
</ul>
</section>
<section id="test-coverage">
<h3>Test Coverage<a class="headerlink" href="#test-coverage" title="Link to this heading">¶</a></h3>
<p>All modified code maintains or improves test coverage:</p>
<ul class="simple">
<li><p>DataHandler signal emissions</p></li>
<li><p>Protocol structural typing</p></li>
<li><p>Interface compliance</p></li>
</ul>
</section>
</section>
<section id="code-quality">
<h2>Code Quality<a class="headerlink" href="#code-quality" title="Link to this heading">¶</a></h2>
<section id="linting">
<h3>Linting<a class="headerlink" href="#linting" title="Link to this heading">¶</a></h3>
<p>All modified files pass ruff linting with no errors:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ruff<span class="w"> </span>check<span class="w"> </span>src/app/<span class="w"> </span>src/core/<span class="w"> </span>src/gui/widgets/timeline/<span class="w"> </span>--output-format<span class="o">=</span>concise
<span class="c1"># Result: All checks passed!</span>
</pre></div>
</div>
</section>
<section id="type-hints">
<h3>Type Hints<a class="headerlink" href="#type-hints" title="Link to this heading">¶</a></h3>
<p>All new code includes proper type hints:</p>
<ul class="simple">
<li><p>Protocol interfaces fully typed</p></li>
<li><p>Callback signatures specified</p></li>
<li><p>Return types documented</p></li>
</ul>
</section>
</section>
<section id="benefits-summary">
<h2>Benefits Summary<a class="headerlink" href="#benefits-summary" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p><strong>Maintainability</strong>: Clear interfaces make changes safer</p></li>
<li><p><strong>Testability</strong>: Components can be tested in isolation</p></li>
<li><p><strong>Flexibility</strong>: Easy to swap implementations</p></li>
<li><p><strong>Clarity</strong>: Dependencies are explicit</p></li>
<li><p><strong>Architecture</strong>: Proper layer separation enforced</p></li>
</ol>
</section>
<section id="backward-compatibility">
<h2>Backward Compatibility<a class="headerlink" href="#backward-compatibility" title="Link to this heading">¶</a></h2>
<p>All changes maintain backward compatibility:</p>
<ul class="simple">
<li><p>Existing functionality preserved</p></li>
<li><p>No breaking changes to public APIs</p></li>
<li><p>Signal-based updates are transparent to other components</p></li>
</ul>
</section>
<section id="future-improvements">
<h2>Future Improvements<a class="headerlink" href="#future-improvements" title="Link to this heading">¶</a></h2>
<p>While the main issues are resolved, potential future enhancements:</p>
<ol class="arabic simple">
<li><p>Further extract logic from MainWindow (still 1500+ lines)</p></li>
<li><p>Consider extracting SessionManager for unsaved changes</p></li>
<li><p>Consider expanding DataHandler into AppController</p></li>
<li><p>Add more comprehensive integration tests</p></li>
</ol>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h2>
<p>This refactoring successfully addresses all identified coupling issues while maintaining minimal changes to the codebase. The architecture now properly respects layer boundaries, uses explicit interfaces, and follows established design patterns for loose coupling.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Christian Mintert
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Loose Coupling Refactoring Summary</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#problems-addressed">Problems Addressed</a><ul>
<li><a class="reference internal" href="#datahandler-mainwindow-tight-coupling-resolved">1. DataHandler → MainWindow Tight Coupling ✅ RESOLVED</a></li>
<li><a class="reference internal" href="#timelinewidget-databaseservice-layer-violation-resolved">2. TimelineWidget → DatabaseService Layer Violation ✅ RESOLVED</a></li>
<li><a class="reference internal" href="#uimanager-mainwindow-implicit-interface-resolved">3. UIManager → MainWindow Implicit Interface ✅ RESOLVED</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a><ul>
<li><a class="reference internal" href="#new-files-created">New Files Created</a></li>
<li><a class="reference internal" href="#files-modified">Files Modified</a><ul>
<li><a class="reference internal" href="#src-app-data-handler-py">src/app/data_handler.py</a></li>
<li><a class="reference internal" href="#src-app-main-py-mainwindow">src/app/main.py (MainWindow)</a></li>
<li><a class="reference internal" href="#src-app-connection-manager-py">src/app/connection_manager.py</a></li>
<li><a class="reference internal" href="#src-app-ui-manager-py">src/app/ui_manager.py</a></li>
<li><a class="reference internal" href="#src-gui-widgets-timeline-timeline-view-py">src/gui/widgets/timeline/timeline_view.py</a></li>
<li><a class="reference internal" href="#src-gui-widgets-timeline-group-band-manager-py">src/gui/widgets/timeline/group_band_manager.py</a></li>
<li><a class="reference internal" href="#src-gui-widgets-timeline-init-py">src/gui/widgets/timeline/<strong>init</strong>.py</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#architectural-improvements">Architectural Improvements</a><ul>
<li><a class="reference internal" href="#before">Before</a></li>
<li><a class="reference internal" href="#after">After</a></li>
</ul>
</li>
<li><a class="reference internal" href="#design-patterns-used">Design Patterns Used</a></li>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#new-tests">New Tests</a></li>
<li><a class="reference internal" href="#test-coverage">Test Coverage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#code-quality">Code Quality</a><ul>
<li><a class="reference internal" href="#linting">Linting</a></li>
<li><a class="reference internal" href="#type-hints">Type Hints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#benefits-summary">Benefits Summary</a></li>
<li><a class="reference internal" href="#backward-compatibility">Backward Compatibility</a></li>
<li><a class="reference internal" href="#future-improvements">Future Improvements</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=1437fa6d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>