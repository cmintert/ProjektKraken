# PyVis Integration Guide

This document details the configuration and workarounds required to integrate `pyvis` network graphs into the ProjektKraken `QWebEngineView` environment.

## 1. Full-Screen Layout

### The Problem
By default, `pyvis` generates an HTML file suitable for standalone viewing. When embedded in a `QWebEngineView`, the graph often fails to fill the viewport height, creating white borders or a collapsed view. This happens because:
1.  The `pyvis` template wraps the network in a Bootstrap `.card` container.
2.  The `.card` container does not have an explicit height set, so it collapses to fit content or uses default spacing.
3.  Setting `height="100%"` on the `Network` object only affects the inner `div`, which is constrained by the parent `.card`.
4.  Standard resets like `margin: 0` on `body` are insufficient because of the intermediate container structure.

### The Solution
To force the graph to fill the entire application pane (100% width and height) without scrollbars or margins, we must inject specific CSS that targets the entire hierarchy:

1.  **HTML & Body**: Must be `100%` height/width with `overflow: hidden` to prevent scrollbars.
2.  **Parent Containers (.card, .card-body)**: Must be explicitly forced to `100%` height/width with `!important` to override Bootstrap defaults.
3.  **Network Div (#mynetwork)**: Must be `100%` height/width.
4.  **Header Elements**: Unused elements like `h1` (heading) and `center` tags generated by the template must be hidden (`display: none`) to prevent layout shifts or "white slivers" at the top.

**CSS Snippet used in `GraphBuilder`:**
```css
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    background-color: #1e1e1e; /* Match app theme */
    overflow: hidden;
}
.card {
    width: 100% !important;
    height: 100% !important;
    background-color: #1e1e1e;
    border: none !important;
    margin: 0 !important;
}
.card-body {
    width: 100% !important;
    height: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    background-color: #1e1e1e;
}
#mynetwork {
    width: 100% !important;
    height: 100% !important;
    background-color: #1e1e1e;
    border: none !important;
    margin: 0 !important;
}
/* Hide unused header elements to prevent top margin slivers */
h1, center {
    display: none !important;
}
```

## 2. ID Formatting

### The Problem
*   **Database**: Stores relations with source/target IDs prefixed with `id:` (e.g., `id:c13f69-...`).
*   **Application**: Reference entities/events using raw UUIDs (e.g., `c13f69-...`).
*   **PyVis**: Requires that edge `source`/`to` match node `id`s exactly.

Mismatching IDs results in `AssertionError: non existent node` or edges not appearing.

### The Solution
When building the graph data in `GraphDataService`, we must normalize IDs by stripping the `id:` prefix from relation source/target fields to match the raw UUIDs used for nodes.

```python
def strip_id_prefix(id_str: str) -> str:
    return id_str[3:] if id_str.startswith("id:") else id_str
```

## 3. Background Color
To ensure a seamless look, the background color must be set at multiple levels:
1.  **QWebEngineView Widget**: `setStyleSheet("background-color: #1e1e1e;")`
2.  **QWebEnginePage**: `page().setBackgroundColor(QColor("#1e1e1e"))` (fills empty space before load)
3.  **PyVis Network**: `bgcolor="#1e1e1e"` in Python config.
4.  **CSS**: `background-color: #1e1e1e` on `html`, `body`, and container divs.
