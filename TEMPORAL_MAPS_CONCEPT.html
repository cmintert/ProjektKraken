<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>ProjektKraken: Temporal Map Markers - Project Kraken 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-brand-primary: #7C3AED;
  --color-brand-content: #7C3AED;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #A78BFA;
  --color-brand-content: #A78BFA;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #A78BFA;
  --color-brand-content: #A78BFA;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Project Kraken 0.5.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">Project Kraken 0.5.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="WIKI_LINKING.html">ID-Based Wiki Linking Implementation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAP_USAGE_EXAMPLES.html">Map System Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="LONGFORM.html">Longform Document Feature</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="DATABASE.html">Database Architecture and Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEVELOPMENT.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="SCHEMA_REFERENCE.html">Database Schema Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="SECURITY.html">Security Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="SEMANTIC_SEARCH.html">Semantic Search in ProjektKraken</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLM_INTEGRATION.html">Multi-Provider LLM Integration Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="TAG_MIGRATION_GUIDE.html">Tag Normalization Migration Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">src</a><input aria-label="Toggle navigation of src" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="app.html">app package</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">cli package</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html">commands package</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">core package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="gui.html">gui package</a><input aria-label="Toggle navigation of gui package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="gui.widgets.html">gui.widgets package</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui.dialogs.html">gui.dialogs package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html">services package</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/TEMPORAL_MAPS_CONCEPT.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="projektkraken-temporal-map-markers">
<h1>ProjektKraken: Temporal Map Markers<a class="headerlink" href="#projektkraken-temporal-map-markers" title="Link to this heading">¶</a></h1>
<section id="architectural-specification-and-implementation-strategy">
<h2>Architectural Specification and Implementation Strategy<a class="headerlink" href="#architectural-specification-and-implementation-strategy" title="Link to this heading">¶</a></h2>
</section>
<section id="executive-summary-the-fourth-dimension-in-digital-cartography">
<h2>1. Executive Summary: The Fourth Dimension in Digital Cartography<a class="headerlink" href="#executive-summary-the-fourth-dimension-in-digital-cartography" title="Link to this heading">¶</a></h2>
<p>The visualization of geospatial data has traditionally been bound by the constraints of static representation—a snapshot of a world frozen in a single moment. However, the narrative requirements of ProjektKraken, specifically in the domains of storytelling, world-building, and historical simulation, demand a fundamental paradigm shift. The “Temporal Map Markers” initiative represents the critical evolution from static 2D maps to dynamic 4D visualizations. This report provides an exhaustive technical analysis and implementation roadmap for this feature, aiming to transform the map from a passive reference image into a living, breathing non-linear editor (NLE) for spatial history.</p>
<p>The core objective is to visualize the state and movement of entities—characters, armies, political borders—as a function of a global time variable, $t$. This requires the system to handle not just the spatial coordinates $(x, y)$, but the temporal existence and trajectory of thousands of entities simultaneously. The architectural challenge is threefold: designing a data model that efficiently queries state at any given $t$; building a rendering pipeline capable of updating thousands of graphical items at 60 frames per second (FPS) within the Python/Qt ecosystem; and constructing a user interface that bridges the gap between spatial manipulation and temporal scrubbing.</p>
<p>Analysis of the technical requirements and available frameworks, particularly PySide6 (Qt for Python), confirms that this vision is achievable. The Qt Graphics View Framework provides the necessary scene graph capabilities, while specific optimization strategies—such as OpenGL viewport integration, spatial indexing bypasses, and coordinate caching—can overcome the inherent performance bottlenecks of high-frequency updates in Python. This document outlines the mathematical foundations for trajectory interpolation, the synchronization logic for a master clock architecture, and the specific user interaction patterns required to enable “Live Puppeteering” and timeline scrubbing.</p>
</section>
<hr class="docutils" />
<section id="theoretical-framework-and-core-vision">
<h2>2. Theoretical Framework and Core Vision<a class="headerlink" href="#theoretical-framework-and-core-vision" title="Link to this heading">¶</a></h2>
<section id="the-limitations-of-static-cartography">
<h3>2.1 The Limitations of Static Cartography<a class="headerlink" href="#the-limitations-of-static-cartography" title="Link to this heading">¶</a></h3>
<p>In traditional Geographic Information Systems (GIS) and fantasy map tools, an entity’s location is defined by a static coordinate tuple $P = (x, y)$. To represent movement, users are often forced to create multiple static markers (e.g., “Army at Start,” “Army at Battle,” “Army at End”) or rely on separate map layers that must be manually toggled. This approach fractures the narrative continuity. It fails to convey velocity, simultaneous action, or the causal relationships between moving bodies. For a storytelling platform like ProjektKraken, the map must be a canvas for events, not just locations.</p>
</section>
<section id="the-temporal-coordinate-system">
<h3>2.2 The Temporal Coordinate System<a class="headerlink" href="#the-temporal-coordinate-system" title="Link to this heading">¶</a></h3>
<p>The “Temporal Map” architecture redefines the fundamental nature of a map marker. An entity $E$ is no longer a static point but a function of time:</p>
<p>$$P(t) = (x(t), y(t))$$</p>
<p>This function is defined over an existence interval $[t_{start}, t_{end}]$.</p>
<ul class="simple">
<li><p><strong>Global Time ($t$)</strong>: A monotonic floating-point value controlled by a central clock.</p></li>
<li><p><strong>Keyframes</strong>: Discrete snapshots of the entity’s state (position, rotation, opacity, metadata) at specific times.</p></li>
<li><p><strong>Continuity</strong>: The system must derive the state of the entity at any arbitrary time $t$ by interpolating between the nearest defined keyframes.</p></li>
</ul>
<p>This shift necessitates a “Non-Linear Editor (NLE) on Map” philosophy. Much like video editing software allows editors to scrub through video frames, ProjektKraken must allow users to scrub through the “history” of their world. The map becomes the viewport, and the underlying data model becomes a collection of temporal tracks.</p>
</section>
<section id="core-use-case-analysis">
<h3>2.3 Core Use Case Analysis<a class="headerlink" href="#core-use-case-analysis" title="Link to this heading">¶</a></h3>
<p>The architecture is driven by three distinct use cases, each imposing unique technical constraints:</p>
<ol class="arabic simple">
<li><p><strong>Tracking Journeys (The Trajectory Problem)</strong>:</p>
<ul class="simple">
<li><p><em>Scenario</em>: Visualizing a character’s travel across a continent.</p></li>
<li><p><em>Constraint</em>: Movement is rarely linear. Characters follow winding roads or rivers. The system must support complex interpolation (Bezier curves) and visual Motion Paths to show the “past” and “future” trajectory.</p></li>
</ul>
</li>
<li><p><strong>Historical Borders (The Vertex Animation Problem)</strong>:</p>
<ul class="simple">
<li><p><em>Scenario</em>: A kingdom expands its territory over 500 years.</p></li>
<li><p><em>Constraint</em>: This involves animating <code class="docutils literal notranslate"><span class="pre">QPolygonF</span></code> items. Unlike point markers, regions may change topology. The system must interpolate vertex positions while maintaining the integrity of the shape.</p></li>
</ul>
</li>
<li><p><strong>Battle Maneuvers (The Swarm Problem)</strong>:</p>
<ul class="simple">
<li><p><em>Scenario</em>: A tactical view of a battle with 1,000 individual troop units.</p></li>
<li><p><em>Constraint</em>: Performance is paramount. Updating the position of 1,000 independent items every 16ms (to achieve 60fps) is a stress test for the Python Global Interpreter Lock (GIL) and the Qt event loop.</p></li>
</ul>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="data-architecture-and-storage-models">
<h2>3. Data Architecture and Storage Models<a class="headerlink" href="#data-architecture-and-storage-models" title="Link to this heading">¶</a></h2>
<p>The foundation of the temporal map is the data structure used to store and retrieve time-based attributes.</p>
<section id="the-temporal-json-schema">
<h3>3.1 The Temporal JSON Schema<a class="headerlink" href="#the-temporal-json-schema" title="Link to this heading">¶</a></h3>
<p>To support the “Time” dimension, the data model for a marker must extend standard GeoJSON-like structures. A “Temporal Entity” is defined by a <code class="docutils literal notranslate"><span class="pre">timeline</span></code> property containing a sorted list of keyframes. This structure must be robust enough to handle position, but also extensible for other animated properties (e.g., opacity, color, scale).</p>
<p><strong>Proposed Data Schema:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Attribute</p></th>
<th class="head text-left"><p>Type</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td class="text-left"><p>UUID</p></td>
<td class="text-left"><p>Unique identifier for the entity.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td class="text-left"><p>String</p></td>
<td class="text-left"><p>Display name (e.g., “The One Ring”).</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">existence</span></code></p></td>
<td class="text-left"><p>Object</p></td>
<td class="text-left"><p>Defines the lifespan: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;start&quot;:</span> <span class="pre">0,</span> <span class="pre">&quot;end&quot;:</span> <span class="pre">3019</span> <span class="pre">}</span></code>.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">timeline</span></code></p></td>
<td class="text-left"><p>List</p></td>
<td class="text-left"><p>A time-sorted list of keyframe objects.</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Keyframe Structure:</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;t&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">150.5</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pos&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.45</span><span class="p">,</span><span class="w"> </span><span class="mf">0.88</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;interpolation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cubic-bezier&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;control_points&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">]],</span>
<span class="w">  </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;opacity&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Camp at Amon Sul&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This schema implies that the state of an entity between two keyframes is derived. If interpolation is “linear,” the system computes a weighted average. If “cubic-bezier,” it evaluates the curve equation.</p>
</section>
<section id="keyframe-storage-and-retrieval-efficiency">
<h3>3.2 Keyframe Storage and Retrieval Efficiency<a class="headerlink" href="#keyframe-storage-and-retrieval-efficiency" title="Link to this heading">¶</a></h3>
<p>During playback, the system requests the position of every entity at the current frame. If an entity has 10,000 keyframes (e.g., a highly detailed recorded path), iterating through the list to find the correct interval is computationally expensive ($O(N)$).</p>
<p><strong>Optimization: Binary Search (Bisect)</strong>
To maximize performance, keyframes must be maintained as a strictly sorted list by time $t$. This allows the use of the binary search algorithm to locate the insertion point for the current time $t$. Python’s standard library <code class="docutils literal notranslate"><span class="pre">bisect</span></code> module provides a highly efficient C-implemented bisection algorithm.</p>
<ul class="simple">
<li><p><strong>Mechanism</strong>: <code class="docutils literal notranslate"><span class="pre">bisect.bisect_right(keyframes,</span> <span class="pre">t)</span></code> returns the index $i$ where $t$ would be inserted.</p></li>
<li><p><strong>Interval</strong>: The current state is derived from <code class="docutils literal notranslate"><span class="pre">keyframes[i-1]</span></code> (start of interval) and <code class="docutils literal notranslate"><span class="pre">keyframes[i]</span></code> (end of interval).</p></li>
<li><p><strong>Complexity</strong>: This reduces the lookup cost from $O(N)$ to $O(\log N)$, which is critical when scrubbing through long histories with thousands of data points.</p></li>
</ul>
<section id="ogc-mf-json-database-storage-format">
<h4>3.2.1 OGC MF-JSON Database Storage Format<a class="headerlink" href="#ogc-mf-json-database-storage-format" title="Link to this heading">¶</a></h4>
<p>Trajectory data is persisted in the <code class="docutils literal notranslate"><span class="pre">moving_features</span></code> table using the <strong>OGC Moving Features JSON</strong> (MF-JSON) format. This standard ensures geospatial interoperability while supporting our temporal requirements.</p>
<p><strong>Database Column</strong>: <code class="docutils literal notranslate"><span class="pre">moving_features.trajectory</span></code> (JSON blob)</p>
<p><strong>MF-JSON Structure (MovingPoint):</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MovingPoint&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">]],</span>
<span class="w">  </span><span class="nt">&quot;datetimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">50.0</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>Always <code class="docutils literal notranslate"><span class="pre">&quot;MovingPoint&quot;</span></code> for point trajectories</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">coordinates</span></code></p></td>
<td><p>Array of <code class="docutils literal notranslate"><span class="pre">[x,</span> <span class="pre">y]</span></code> normalized positions (0.0 - 1.0)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">datetimes</span></code></p></td>
<td><p>Array of time values (lore_date floats), aligned with coordinates</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Future Extensions</strong> (not yet implemented):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">interpolation</span></code>: Specify curve type (<code class="docutils literal notranslate"><span class="pre">&quot;Linear&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;Step&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;CubicBezier&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">properties</span></code>: Dynamic attributes that change over time (e.g., speed, status)</p></li>
</ul>
<p><strong>Serialization Helpers</strong> (<code class="docutils literal notranslate"><span class="pre">src/core/trajectory.py</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keyframes_to_mfjson(keyframes:</span> <span class="pre">list[Keyframe])</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mfjson_to_keyframes(data:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">list[Keyframe]</span></code></p></li>
</ul>
</section>
</section>
<section id="calendar-integration-mapping-t-to-dates">
<h3>3.3 Calendar Integration: Mapping $t$ to Dates<a class="headerlink" href="#calendar-integration-mapping-t-to-dates" title="Link to this heading">¶</a></h3>
<p>A request from the “Future Roadmap” is to map the abstract float $t$ to actual calendar dates (e.g., “Year 3018, March 25”).</p>
<p><strong>The Epoch System</strong>:
The system should operate internally on a float $t$ (representing atomic units, e.g., hours or days since a global epoch). A translation layer handles the conversion to human-readable dates.</p>
<ul class="simple">
<li><p><strong>Calendar Model</strong>: A <code class="docutils literal notranslate"><span class="pre">CalendarSystem</span></code> class defines the rules (months per year, days per month, leap year logic).</p></li>
<li><p><strong>Mapping</strong>:
$$Date = Epoch + t \times UnitScale$$
This separation of concerns allows the underlying animation engine to work with fast float arithmetic while the UI layer handles the complex string formatting of fantasy dates.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="the-rendering-pipeline-qt-graphics-view-framework">
<h2>4. The Rendering Pipeline: Qt Graphics View Framework<a class="headerlink" href="#the-rendering-pipeline-qt-graphics-view-framework" title="Link to this heading">¶</a></h2>
<p>The visual implementation relies on the Qt Graphics View Framework (accessible via PySide6), which utilizes a Model-View-Controller (MVC) architecture specifically designed for managing large numbers of 2D items.</p>
<section id="the-scene-graph-qgraphicsscene">
<h3>4.1 The Scene Graph (QGraphicsScene)<a class="headerlink" href="#the-scene-graph-qgraphicsscene" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">QGraphicsScene</span></code> acts as the spatial data model. It manages the geometry of all items (markers, paths, terrain) and handles collision detection.</p>
<ul class="simple">
<li><p><strong>Coordinate System</strong>: The scene operates in logical coordinates (Map Units), independent of the screen resolution or zoom level.</p></li>
<li><p><strong>Coordinate Mapping</strong>: Interaction requires constant translation between View (Pixel) and Scene (Map) coordinates.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">view.mapToScene(QPoint)</span></code>: Converts mouse pixel coordinates to map locations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">view.mapFromScene(QPointF)</span></code>: Converts map locations to screen pixels (essential for static UI overlays).</p></li>
</ul>
</li>
<li><p><strong>Spatial Indexing</strong>: The scene uses a Binary Space Partitioning (BSP) tree by default to rapidly locate items. While efficient for static scenes, this index can become a bottleneck for moving items, as the tree must be rebuilt whenever an item changes position.</p></li>
</ul>
</section>
<section id="the-viewport-qgraphicsview">
<h3>4.2 The Viewport (QGraphicsView)<a class="headerlink" href="#the-viewport-qgraphicsview" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">QGraphicsView</span></code> is the widget that renders the scene. It handles the transformation matrix (zoom/pan) and user input events.</p>
<ul>
<li><p><strong>Render Engine</strong>: By default, <code class="docutils literal notranslate"><span class="pre">QGraphicsView</span></code> uses a raster paint engine (CPU-based). For high-performance animation of thousands of items, this is often insufficient.</p></li>
<li><p><strong>OpenGL Acceleration</strong>: The viewport can be backed by a <code class="docutils literal notranslate"><span class="pre">QOpenGLWidget</span></code>, forcing Qt to use the GPU for composition and rendering. This is a critical optimization for the “Battle Maneuvers” use case.</p></li>
<li><p><strong>Y-Axis Inversion</strong>: Standard GIS coordinates have $Y$ pointing Up (North), while Qt screen coordinates have $Y$ pointing Down. To align these, apply a scale transformation to the view: <code class="docutils literal notranslate"><span class="pre">view.scale(1,</span> <span class="pre">-1)</span></code>. This allows the scene logic to remain consistent with Cartesian GIS standards.</p></li>
<li><p><strong>Infinite Canvas Policy</strong>: To implement a modern “drag-to-pan” map style, disable the default scrollbars:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">view</span><span class="o">.</span><span class="n">setHorizontalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">setVerticalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">view</span> <span class="o">=</span> <span class="n">QGraphicsView</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">setViewport</span><span class="p">(</span><span class="n">QOpenGLWidget</span><span class="p">())</span>
<span class="c1"># Invert Y axis to match GIS conventions</span>
<span class="n">view</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-temporal-marker-item-qgraphicsitem">
<h3>4.3 The Temporal Marker Item (QGraphicsItem)<a class="headerlink" href="#the-temporal-marker-item-qgraphicsitem" title="Link to this heading">¶</a></h3>
<p>Each map marker is a subclass of <code class="docutils literal notranslate"><span class="pre">QGraphicsItem</span></code> (or <code class="docutils literal notranslate"><span class="pre">QGraphicsObject</span></code> if signals are needed).</p>
<ul class="simple">
<li><p><strong>Paint Method</strong>: The <code class="docutils literal notranslate"><span class="pre">paint()</span></code> method draws the visual representation (e.g., an SVG icon or a circle).</p></li>
<li><p><strong>Bounding Rect</strong>: The <code class="docutils literal notranslate"><span class="pre">boundingRect()</span></code> method defines the area requiring updates. Accurately defining this is crucial for the view to optimize repaints.</p></li>
<li><p><strong>State Updates</strong>: Unlike standard items, a temporal marker does not store a fixed position. Instead, it subscribes to the global clock and updates its position via <code class="docutils literal notranslate"><span class="pre">setPos()</span></code> whenever the time changes.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="algorithmic-core-interpolation-and-trajectory">
<h2>5. Algorithmic Core: Interpolation and Trajectory<a class="headerlink" href="#algorithmic-core-interpolation-and-trajectory" title="Link to this heading">¶</a></h2>
<p>To create smooth motion from discrete keyframes, the system must employ robust interpolation algorithms.</p>
<section id="linear-interpolation-lerp">
<h3>5.1 Linear Interpolation (Lerp)<a class="headerlink" href="#linear-interpolation-lerp" title="Link to this heading">¶</a></h3>
<p>For strategic movements (e.g., “Army moves from City A to City B”), linear interpolation is sufficient and computationally cheap.
Given:</p>
<ul class="simple">
<li><p>Start Keyframe: $K_1$ at $t_1$, pos $P_1$</p></li>
<li><p>End Keyframe: $K_2$ at $t_2$, pos $P_2$</p></li>
<li><p>Current Time: $t$ where $t_1 \le t \le t_2$</p></li>
</ul>
<p>The normalized progress factor $\alpha$ is:
$$\alpha = \frac{t - t_1}{t_2 - t_1}$$</p>
<p>The position $P(t)$ is:
$$P(t) = P_1 + (P_2 - P_1) \times \alpha$$</p>
</section>
<section id="bezier-interpolation-organic-movement">
<h3>5.2 Bezier Interpolation (Organic Movement)<a class="headerlink" href="#bezier-interpolation-organic-movement" title="Link to this heading">¶</a></h3>
<p>For tracking journeys along rivers or roads, linear movement looks robotic. Cubic Bezier curves provide the necessary smoothness. A cubic Bezier segment is defined by four points: $P_0$ (start), $P_1$ (control 1), $P_2$ (control 2), and $P_3$ (end).</p>
<p>The equation for a point on the curve is:
$$B(\tau) = (1-\tau)^3P_0 + 3(1-\tau)^2\tau P_1 + 3(1-\tau)\tau^2 P_2 + \tau^3P_3$$</p>
<p><strong>The Parameterization Challenge</strong>:
In the standard Bezier equation, $\tau$ varies from 0 to 1. However, simply mapping the time progress $\alpha$ to $\tau$ results in non-uniform speed along the curve (the marker speeds up and slows down depending on the curvature).</p>
<ul class="simple">
<li><p><strong>Solution</strong>: For strict constant-speed travel, the system must perform arc-length parameterization (remapping $\alpha$ to distance).</p></li>
<li><p><strong>Approximation</strong>: For the scale of ProjektKraken, a direct mapping ($\tau \approx \alpha$) is often visually acceptable and significantly faster to compute than numerical integration of arc length. If “perfect” speed is required, a lookup table (LUT) of arc lengths can be pre-calculated for each segment.</p></li>
</ul>
</section>
<section id="region-animation-polygon-morphing">
<h3>5.3 Region Animation (Polygon Morphing)<a class="headerlink" href="#region-animation-polygon-morphing" title="Link to this heading">¶</a></h3>
<p>Animating the borders of a kingdom requires interpolating <code class="docutils literal notranslate"><span class="pre">QPolygonF</span></code> objects.</p>
<ul class="simple">
<li><p><strong>Topology Consistency</strong>: Morphing between two polygons works best if they have the same number of vertices.</p></li>
<li><p><strong>Algorithm</strong>:</p>
<ol class="arabic simple">
<li><p>Ensure $K_1$ (Polygon A) and $K_2$ (Polygon B) have $N$ vertices. (If not, vertex insertion is required).</p></li>
<li><p>For each vertex index $i$, linearly interpolate between $V_{A,i}$ and $V_{B,i}$.</p></li>
<li><p>Reconstruct the <code class="docutils literal notranslate"><span class="pre">QPolygonF</span></code> at time $t$ with the new vertex positions.</p></li>
</ol>
</li>
</ul>
<p>This allows regions to expand, contract, or shift smoothly over time.</p>
</section>
</section>
<hr class="docutils" />
<section id="time-management-architecture">
<h2>6. Time Management Architecture<a class="headerlink" href="#time-management-architecture" title="Link to this heading">¶</a></h2>
<p>The synchronization of the entire application relies on a robust “Master Clock” architecture.</p>
<section id="the-master-clock-controller">
<h3>6.1 The Master Clock Controller<a class="headerlink" href="#the-master-clock-controller" title="Link to this heading">¶</a></h3>
<p>Unlike simple animations that might use <code class="docutils literal notranslate"><span class="pre">QPropertyAnimation</span></code> on individual items, a global timeline requires a centralized controller. This <code class="docutils literal notranslate"><span class="pre">MasterClock</span></code> is a <code class="docutils literal notranslate"><span class="pre">QObject</span></code> that maintains the authoritative current time $t$.</p>
<ul class="simple">
<li><p><strong>Signal Propagation</strong>: The clock emits a <code class="docutils literal notranslate"><span class="pre">timeChanged(float</span> <span class="pre">t)</span></code> signal.</p></li>
<li><p><strong>Subscription</strong>: The <code class="docutils literal notranslate"><span class="pre">QGraphicsScene</span></code> or individual <code class="docutils literal notranslate"><span class="pre">TemporalMarker</span></code> items connect to this signal.</p></li>
<li><p><strong>Scrubbing Logic</strong>: When the user drags the timeline scrubber, the clock updates $t$ directly without advancing the internal timer.</p></li>
<li><p><strong>Playback Logic</strong>: When “Play” is active, a <code class="docutils literal notranslate"><span class="pre">QTimer</span></code> fires (e.g., every 16ms), incrementing $t$ by a delta ($\Delta t$) determined by the playback speed.</p></li>
</ul>
</section>
<section id="handling-time-skips-and-non-linear-access">
<h3>6.2 Handling “Time Skips” and Non-Linear Access<a class="headerlink" href="#handling-time-skips-and-non-linear-access" title="Link to this heading">¶</a></h3>
<p>When the user scrubs the timeline (jumps from $t=100$ to $t=5000$), the system must handle the state change gracefully.</p>
<ul class="simple">
<li><p><strong>Instant Updates</strong>: The interpolation logic is stateless; it depends only on the current $t$. Therefore, a jump is handled identically to a sequential update: binary search for the new interval, calculate position, update view.</p></li>
<li><p><strong>Event Triggers</strong>: If the system supports “Events” (e.g., “Battle starts at $t=300$”), the clock logic must detect if an event timestamp was crossed during the jump, although for pure visualization, calculating the static state is usually sufficient.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="user-interface-the-timeline-widget">
<h2>7. User Interface: The Timeline Widget<a class="headerlink" href="#user-interface-the-timeline-widget" title="Link to this heading">¶</a></h2>
<p>The “Timeline Widget” is the primary interface for temporal manipulation, docking at the bottom of the map view.</p>
<section id="architecture-of-the-timeline">
<h3>7.1 Architecture of the Timeline<a class="headerlink" href="#architecture-of-the-timeline" title="Link to this heading">¶</a></h3>
<p>The timeline is effectively a custom <code class="docutils literal notranslate"><span class="pre">QWidget</span></code> that draws a representation of time.</p>
<ul class="simple">
<li><p><strong>The Ruler</strong>: A horizontal bar rendering time ticks. It requires a coordinate transform to map “Pixels” to “Time Units” (Zooming the timeline).</p></li>
<li><p><strong>The Playhead</strong>: A vertical indicator representing the current $t$ of the Master Clock.</p></li>
<li><p><strong>Tracks</strong>: Rows corresponding to selected entities. Each track displays the keyframes (diamonds) and existence duration (bars) of that entity.</p></li>
</ul>
</section>
<section id="synchronization-logic">
<h3>7.2 Synchronization Logic<a class="headerlink" href="#synchronization-logic" title="Link to this heading">¶</a></h3>
<p>The Timeline and the Map must be tightly coupled:</p>
<ol class="arabic simple">
<li><p><strong>Timeline $\rightarrow$ Map</strong>: Dragging the playhead emits <code class="docutils literal notranslate"><span class="pre">set_time(t)</span></code> to the Master Clock, which updates the Map markers.</p></li>
<li><p><strong>Map $\rightarrow$ Timeline</strong>: Selecting a marker on the map adds its “Track” to the timeline widget. Dragging a keyframe node on the map (spatial edit) updates the keyframe’s time/position in the data model, which triggers a repaint of the timeline track.</p></li>
</ol>
</section>
<section id="zoom-and-pan-on-the-time-axis">
<h3>7.3 Zoom and Pan on the Time Axis<a class="headerlink" href="#zoom-and-pan-on-the-time-axis" title="Link to this heading">¶</a></h3>
<p>Users need to switch between “Tactical Time” (seconds/minutes) and “Historical Time” (years/centuries).</p>
<ul class="simple">
<li><p><strong>Implementation</strong>: The Timeline Widget handles <code class="docutils literal notranslate"><span class="pre">wheelEvent</span></code>. Scrolling modifies a <code class="docutils literal notranslate"><span class="pre">scale_factor</span></code> (pixels per time unit).</p></li>
<li><p><strong>Rendering</strong>: The drawing logic uses this scale factor to determine the interval of tick marks (e.g., labeling every 10 years vs every 10 minutes).</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="interaction-design-the-nle-on-map">
<h2>8. Interaction Design: The “NLE on Map”<a class="headerlink" href="#interaction-design-the-nle-on-map" title="Link to this heading">¶</a></h2>
<p>The user interface must facilitate not just viewing, but creating these complex journeys.</p>
<section id="live-puppeteering-recording-mode">
<h3>8.1 Live Puppeteering (Recording Mode)<a class="headerlink" href="#live-puppeteering-recording-mode" title="Link to this heading">¶</a></h3>
<p>A unique feature of ProjektKraken is the ability to “act out” a journey.</p>
<ul class="simple">
<li><p><strong>Mechanism</strong>:</p>
<ol class="arabic simple">
<li><p>User toggles “Record” mode.</p></li>
<li><p>User drags a marker on the map.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">QTimer</span></code> samples the mouse position at a fixed interval (e.g., 100ms) or on every <code class="docutils literal notranslate"><span class="pre">mouseMoveEvent</span></code>.</p></li>
<li><p>Each sample is saved as a keyframe: <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">t:</span> <span class="pre">current_time,</span> <span class="pre">x:</span> <span class="pre">mouse_x,</span> <span class="pre">y:</span> <span class="pre">mouse_y</span> <span class="pre">}</span></code>.</p></li>
</ol>
</li>
<li><p><strong>Smoothing</strong>: Raw mouse input is jittery and dense. Post-processing is required. The Douglas-Peucker algorithm or simple distance-based filtering can reduce the number of keyframes while preserving the shape of the motion.</p></li>
</ul>
</section>
<section id="motion-path-visualization-and-editing">
<h3>8.2 Motion Path Visualization and Editing<a class="headerlink" href="#motion-path-visualization-and-editing" title="Link to this heading">¶</a></h3>
<p>When a marker is selected, its path becomes visible.</p>
<ul class="simple">
<li><p><strong>Visual Component</strong>: A <code class="docutils literal notranslate"><span class="pre">QGraphicsPathItem</span></code> draws the trajectory.</p></li>
<li><p><strong>Node Editing</strong>: The keyframes appear as small, draggable handles along the path.</p></li>
<li><p><strong>Interaction</strong>:</p>
<ul>
<li><p><strong>Click &amp; Drag Node</strong>: Updates the $(x, y)$ of that keyframe.</p></li>
<li><p><strong>Right Click Node</strong>: Opens a context menu to change interpolation (e.g., “Switch to Bezier”).</p></li>
<li><p><strong>Tangent Handles</strong>: If Bezier is selected, two additional handles (control points) appear, allowing the user to shape the curve.</p></li>
</ul>
</li>
</ul>
</section>
<section id="selection-challenges-in-a-dynamic-scene">
<h3>8.3 Selection Challenges in a Dynamic Scene<a class="headerlink" href="#selection-challenges-in-a-dynamic-scene" title="Link to this heading">¶</a></h3>
<p>Selecting a moving object is difficult.</p>
<ul class="simple">
<li><p><strong>Hit Testing</strong>: Qt’s <code class="docutils literal notranslate"><span class="pre">QGraphicsView</span></code> handles hit testing via <code class="docutils literal notranslate"><span class="pre">itemAt()</span></code>. However, if the item is moving 60 times a second, the user might miss.</p></li>
<li><p><strong>Selection Implementation</strong>:</p>
<ul>
<li><p><strong>Flags</strong>: Enable selection on items using <code class="docutils literal notranslate"><span class="pre">item.setFlag(QGraphicsItem.ItemIsSelectable,</span> <span class="pre">True)</span></code>.</p></li>
<li><p><strong>Retrieval</strong>: Use <code class="docutils literal notranslate"><span class="pre">scene.selectedItems()</span></code> to get the current selection.</p></li>
<li><p><strong>Rubberband</strong>: Enable rectangular selection with <code class="docutils literal notranslate"><span class="pre">view.setDragMode(QGraphicsView.RubberBandDrag)</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Pause-on-Click</strong>: A common UX pattern is to pause the Master Clock momentarily when the user presses the mouse button down, allowing for easier selection and manipulation.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="performance-engineering-rendering-at-scale">
<h2>9. Performance Engineering: Rendering at Scale<a class="headerlink" href="#performance-engineering-rendering-at-scale" title="Link to this heading">¶</a></h2>
<p>The requirement to support “thousands of markers” at 60fps is the most significant technical risk. The Python Global Interpreter Lock (GIL) and the overhead of crossing the Python/C++ boundary in PySide6 can lead to performance degradation.</p>
<section id="optimizing-the-scene-graph">
<h3>9.1 Optimizing the Scene Graph<a class="headerlink" href="#optimizing-the-scene-graph" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Disable Spatial Indexing (NoIndex)</strong>:
The <code class="docutils literal notranslate"><span class="pre">QGraphicsScene</span></code> uses a BSP tree to index items. When an item moves, the tree must be updated. For 1,000 moving items, this re-indexing is expensive.</p>
<ul>
<li><p><strong>Strategy</strong>: For the layer containing moving units, call <code class="docutils literal notranslate"><span class="pre">scene.setItemIndexMethod(QGraphicsScene.NoIndex)</span></code>. This disables the index. Collision detection becomes $O(N)$, but the frame update cost drops significantly.</p></li>
</ul>
</li>
<li><p><strong>Item Coordinate Cache</strong>:
Complex markers (e.g., detailed SVG sigils) are expensive to paint.</p>
<ul>
<li><p><strong>Strategy</strong>: Enable <code class="docutils literal notranslate"><span class="pre">QGraphicsItem.ItemCoordinateCache</span></code>. Qt renders the item to an offscreen pixmap and reuses it as long as the item’s appearance doesn’t change (even if it moves). This shifts the load from the CPU (painting) to the GPU (texture blitting).</p></li>
</ul>
</li>
</ul>
</section>
<section id="the-opengl-viewport-solution">
<h3>9.2 The OpenGL Viewport Solution<a class="headerlink" href="#the-opengl-viewport-solution" title="Link to this heading">¶</a></h3>
<p>Standard <code class="docutils literal notranslate"><span class="pre">QWidget</span></code> viewports perform rasterization on the CPU.</p>
<ul class="simple">
<li><p><strong>Strategy</strong>: Set the <code class="docutils literal notranslate"><span class="pre">QGraphicsView</span></code> viewport to <code class="docutils literal notranslate"><span class="pre">QOpenGLWidget</span></code>.</p></li>
<li><p><strong>Benefit</strong>: This unlocks hardware acceleration. Modern GPUs can handle the composition of thousands of textured quads (the cached markers) with ease, bypassing the CPU bottleneck of software rasterization.</p></li>
</ul>
</section>
<section id="level-of-detail-lod">
<h3>9.3 Level of Detail (LOD)<a class="headerlink" href="#level-of-detail-lod" title="Link to this heading">¶</a></h3>
<p>Rendering full details for 1,000 units when zoomed out is wasteful.</p>
<ul class="simple">
<li><p><strong>Strategy</strong>: Implement LOD in the <code class="docutils literal notranslate"><span class="pre">paint()</span></code> method.</p>
<ul>
<li><p><strong>High Zoom</strong>: Draw full SVG marker.</p></li>
<li><p><strong>Medium Zoom</strong>: Draw simplified geometric shape.</p></li>
<li><p><strong>Low Zoom</strong>: Draw a single pixel or dot.</p></li>
</ul>
</li>
<li><p><strong>Implementation</strong>: Use <code class="docutils literal notranslate"><span class="pre">QStyleOptionGraphicsItem.levelOfDetailFromTransform</span></code> to determine the current zoom factor and branch the painting logic accordingly.</p></li>
</ul>
</section>
<section id="batching-updates">
<h3>9.4 Batching Updates<a class="headerlink" href="#batching-updates" title="Link to this heading">¶</a></h3>
<p>To avoid 1,000 separate Python-to-C++ calls per frame:</p>
<ul class="simple">
<li><p><strong>Strategy</strong>: Vectorize the math. Use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> to calculate the positions of all 1,000 units for time $t$ in a single batch operation. While updating the <code class="docutils literal notranslate"><span class="pre">QGraphicsItem</span></code> positions still requires a loop, the heavy lifting of interpolation is done in optimized C code via <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p></li>
<li><p><strong>Thread Safety</strong>: <strong>Critical Warning</strong>: Qt Widgets are NOT thread-safe. Do not attempt to update <code class="docutils literal notranslate"><span class="pre">QGraphicsItem</span></code> positions from a background thread.</p>
<ul>
<li><p><strong>Pattern</strong>: Calculate positions in a worker thread (or <code class="docutils literal notranslate"><span class="pre">numpy</span></code> op), then emit a signal with the result. A slot on the main thread receives the data and efficiently calls <code class="docutils literal notranslate"><span class="pre">setPos</span></code> on the items.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="advanced-features-and-future-roadmap">
<h2>10. Advanced Features and Future Roadmap<a class="headerlink" href="#advanced-features-and-future-roadmap" title="Link to this heading">¶</a></h2>
<section id="ghost-trails-motion-history">
<h3>10.1 Ghost Trails (Motion History)<a class="headerlink" href="#ghost-trails-motion-history" title="Link to this heading">¶</a></h3>
<p>Visualizing where an entity was is crucial for understanding battle maneuvers.</p>
<ul class="simple">
<li><p><strong>Implementation Options</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Particle System</strong>: Spawn fading “ghost” items behind the marker. Drawback: Explodes the item count (1,000 units $\times$ 10 ghosts = 10,000 items).</p></li>
<li><p><strong>Path Stroking (Recommended)</strong>: Each marker maintains a <code class="docutils literal notranslate"><span class="pre">QPolygonF</span></code> of its last $N$ positions. The <code class="docutils literal notranslate"><span class="pre">paint()</span></code> method draws this polyline.</p></li>
</ol>
</li>
<li><p><strong>Fading Effect</strong>: Using a <code class="docutils literal notranslate"><span class="pre">QLinearGradient</span></code> brush along the path allows the trail to fade out smoothly without managing transparency for separate items. This is far more performant than particle systems in a <code class="docutils literal notranslate"><span class="pre">QGraphicsView</span></code> context.</p></li>
</ul>
</section>
<section id="visibility-and-existence-intervals">
<h3>10.2 Visibility and Existence Intervals<a class="headerlink" href="#visibility-and-existence-intervals" title="Link to this heading">¶</a></h3>
<p>Entities that “die” or haven’t been “born” must be hidden.</p>
<ul class="simple">
<li><p><strong>Optimization</strong>: Simply calling <code class="docutils literal notranslate"><span class="pre">hide()</span></code> is not enough if the system still iterates over them.</p></li>
<li><p><strong>Active List</strong>: Maintain a separate list of “Active Entities” for the current time window. Only update and render items in this list. When $t$ crosses an existence boundary ($t_{start}$ or $t_{end}$), move the entity between the “Active” and “Inactive” lists.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="implementation-roadmap">
<h2>11. Implementation Roadmap<a class="headerlink" href="#implementation-roadmap" title="Link to this heading">¶</a></h2>
<p><strong>Phase 1: The Core Engine (Completed)</strong></p>
<ol class="arabic simple">
<li><p>[x] Implement <code class="docutils literal notranslate"><span class="pre">TemporalEntity</span></code> class and JSON schema (<code class="docutils literal notranslate"><span class="pre">TrajectoryRepository</span></code>).</p></li>
<li><p>[x] Build <code class="docutils literal notranslate"><span class="pre">MasterClock</span></code> and basic <code class="docutils literal notranslate"><span class="pre">QTimer</span></code> playback loop (<code class="docutils literal notranslate"><span class="pre">TimelineView</span></code>).</p></li>
<li><p>[x] Implement <code class="docutils literal notranslate"><span class="pre">bisect</span></code> based keyframe lookup (<code class="docutils literal notranslate"><span class="pre">interpolate_position</span></code>).</p></li>
</ol>
<p><strong>Phase 2: The Viewer (Completed)</strong></p>
<ol class="arabic simple">
<li><p>[x] Set up <code class="docutils literal notranslate"><span class="pre">QGraphicsScene</span></code> with <code class="docutils literal notranslate"><span class="pre">QOpenGLWidget</span></code> viewport.</p></li>
<li><p>[x] Implement <code class="docutils literal notranslate"><span class="pre">TemporalMarker</span></code> item with <code class="docutils literal notranslate"><span class="pre">setPos</span></code> updates (<code class="docutils literal notranslate"><span class="pre">MarkerItem</span></code>).</p></li>
<li><p>[x] Create the Timeline Widget with basic scrubbing.</p></li>
<li><p>[x] Implement Clamped Persistence and Transient State logic.</p></li>
</ol>
<p><strong>Phase 3: Interaction &amp; Recording (In Progress)</strong></p>
<ol class="arabic simple">
<li><p>[x] Add Motion Path visualization (<code class="docutils literal notranslate"><span class="pre">QGraphicsPathItem</span></code>).</p></li>
<li><p>[x] Implement node dragging and keyframe editing (Spatial &amp; Temporal Modes).</p></li>
<li><p>[x] Implement Draft Mode (Transient State) with Visual Feedback.</p></li>
<li><p>[x] Implement Playhead Persistence.</p></li>
<li><p>[ ] Implement “Record” mode with mouse sampling.</p></li>
<li><p>[ ] Implement Bezier control points and interpolation.</p></li>
</ol>
<p><strong>Phase 4: Optimization &amp; Scale (Pending)</strong></p>
<ol class="arabic simple">
<li><p>[ ] Profile with 1,000 items.</p></li>
<li><p>[ ] Implement <code class="docutils literal notranslate"><span class="pre">ItemCoordinateCache</span></code> and <code class="docutils literal notranslate"><span class="pre">NoIndex</span></code>.</p></li>
<li><p>[ ] Add Level of Detail (LOD) logic.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="comparison-of-optimization-techniques">
<h2>12. Comparison of Optimization Techniques<a class="headerlink" href="#comparison-of-optimization-techniques" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Technique</p></th>
<th class="head text-left"><p>Implementation Effort</p></th>
<th class="head text-left"><p>Performance Gain</p></th>
<th class="head text-left"><p>Use Case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Binary Search (Bisect)</strong></p></td>
<td class="text-left"><p>Low</p></td>
<td class="text-left"><p>High ($O(\log N)$ lookup)</p></td>
<td class="text-left"><p>Playback/Scrubbing of long histories.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>OpenGL Viewport</strong></p></td>
<td class="text-left"><p>Medium</p></td>
<td class="text-left"><p>Very High (GPU Render)</p></td>
<td class="text-left"><p>Rendering 1000+ items; Battle Maneuvers.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Item Coordinate Cache</strong></p></td>
<td class="text-left"><p>Low</p></td>
<td class="text-left"><p>High (Texture Blitting)</p></td>
<td class="text-left"><p>Complex SVG markers moving without scaling.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>NoIndex (BSP Bypass)</strong></p></td>
<td class="text-left"><p>Low</p></td>
<td class="text-left"><p>High (Update Speed)</p></td>
<td class="text-left"><p>Constant movement of many items.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>LOD (Level of Detail)</strong></p></td>
<td class="text-left"><p>Medium</p></td>
<td class="text-left"><p>Medium (Paint reduction)</p></td>
<td class="text-left"><p>Viewing the whole world map (Zoomed out).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="current-implementation-status-jan-2026">
<h2>13. Current Implementation Status (Jan 2026)<a class="headerlink" href="#current-implementation-status-jan-2026" title="Link to this heading">¶</a></h2>
<section id="completed-groundwork">
<h3>Completed Groundwork<a class="headerlink" href="#completed-groundwork" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Rendering Engine</strong>: <code class="docutils literal notranslate"><span class="pre">MapGraphicsView</span></code> has been upgraded to use <code class="docutils literal notranslate"><span class="pre">QOpenGLWidget</span></code> as the viewport. This provides the GPU acceleration foundation required for future high-load scenarios.</p></li>
<li><p><strong>Coordinate System</strong>: A strict <strong>Cartesian 2D</strong> abstraction layer (<code class="docutils literal notranslate"><span class="pre">MapCoordinateSystem</span></code>) has been implemented.</p>
<ul>
<li><p>It cleanly separates Normalized [0, 1] logic from Scene/Pixel logic.</p></li>
<li><p>It is architected to support future <code class="docutils literal notranslate"><span class="pre">pyproj</span></code> integration without breaking the UI.</p></li>
<li><p><strong>Note</strong>: Full Y-Axis Inversion is prepared for but not yet active to match current static map behavior.</p></li>
</ul>
</li>
<li><p><strong>Database Schema</strong>: The <code class="docutils literal notranslate"><span class="pre">moving_features</span></code> table has been added to the SQLite schema.</p>
<ul>
<li><p>Trajectories are stored in <strong>OGC MF-JSON format</strong> (<code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;MovingPoint&quot;,</span> <span class="pre">&quot;coordinates&quot;:</span> <span class="pre">[...],</span> <span class="pre">&quot;datetimes&quot;:</span> <span class="pre">[...]}</span></code>).</p></li>
<li><p>Auto-migration converts legacy <code class="docutils literal notranslate"><span class="pre">[[t,x,y],...]</span></code> format on database connect.</p></li>
<li><p>Temporal indices (<code class="docutils literal notranslate"><span class="pre">t_start</span></code>, <code class="docutils literal notranslate"><span class="pre">t_end</span></code>) are in place for efficient queries.</p></li>
</ul>
</li>
<li><p><strong>Interaction</strong>: The map now uses an “Infinite Canvas” interaction model (Scrollbars disabled, Drag-to-Pan enforced).</p></li>
</ul>
</section>
<section id="marker-visualization-ui">
<h3>Marker Visualization &amp; UI<a class="headerlink" href="#marker-visualization-ui" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Permanent Marker Labels</strong>:</p>
<ul>
<li><p>Markers now feature a permanent label displaying the linked item’s name (Entities/Events).</p></li>
<li><p>Styled in dark grey (<strong>#333333</strong>) using bold <strong>8pt Segoe UI</strong> font.</p></li>
<li><p>Labels inherit the <code class="docutils literal notranslate"><span class="pre">ItemIgnoresTransformations</span></code> flag, ensuring they remain legible and correctly positioned regardless of map zoom.</p></li>
</ul>
</li>
<li><p><strong>Description Tooltips</strong>: Tooltips now prioritize the item’s <code class="docutils literal notranslate"><span class="pre">description</span></code> field for richer context, falling back to the <code class="docutils literal notranslate"><span class="pre">label</span></code> if no description is available.</p></li>
<li><p><strong>Smart Marker Scale</strong>: Markers and their associated visual elements leverage dynamic scaling and hitbox adjustments for professional “pixel-perfect” interaction.</p></li>
</ul>
</section>
<section id="interaction-visualization">
<h3>Interaction &amp; Visualization<a class="headerlink" href="#interaction-visualization" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Manual Keyframing (Snapshots)</strong>: Added “Add Keyframe” button to the Map toolbar. This allows users to set precise snapshots of marker state at specific timeline moments.</p></li>
<li><p><strong>Constraint: Entity-Only Keyframes</strong>: Keyframing is strictly reserved for <strong>Entity</strong> markers. <strong>Event</strong> markers are treated as static chronological pins without trajectories. UI controls (Add Keyframe button) automatically disable when an Event is selected.</p></li>
<li><p><strong>Trajectory Visualizer &amp; Clamped Persistence</strong>:</p>
<ul>
<li><p><strong>Visual Cues</strong>: When a marker is selected, its entire trajectory is rendered as a dashed path.</p></li>
<li><p><strong>Clamped Persistence</strong>: Trajectory authority is now absolute. If the playhead is before the first keyframe or after the last, the marker remains locked at that endpoint’s position rather than returning to a static “home”.</p></li>
<li><p><strong>Transient State</strong>: Users can drag trajectory-based markers to “audition” new keyframe positions. This enters a “Transient State” (logged in UI) where the marker stays at the dropped position.</p></li>
<li><p><strong>Authority &amp; Snap-Back</strong>: Trajectory authority is enforced on <strong>Time Change</strong>. Scrubbing the timeline clears all transient offsets and snaps markers back to their mathematically defined paths.</p></li>
<li><p><strong>Keyframe Indicators</strong>: Individual keyframes are visualized as dots on the map, providing immediate visual feedback of the “history” of the entity.</p></li>
<li><p><strong>Zoom-Aware Rendering</strong>: Keyframe dots scale with zoom level to maintain visual consistency.</p></li>
</ul>
</li>
<li><p><strong>Multi-Action Keyframe Gizmo</strong> (Implemented):</p>
<ul>
<li><p><strong>Activation</strong>: Hovering a keyframe dot reveals a dual-icon gizmo (matched to dot size).</p></li>
<li><p><strong>Spatial Editing</strong>: Dragging the dot directly repositions $(x, y)$ coordinates. The trajectory path updates in real-time (Rubber-Banding).</p></li>
<li><p><strong>Clock Mode (Temporal Edit)</strong>:</p>
<ul>
<li><p><strong>Action</strong>: Clicking the <strong>Clock icon</strong> (left) “Pins” the keyframe, locking its spatial position but unlocking its timestamp.</p></li>
<li><p><strong>Timeline Jump</strong>: Clicking the clock icon now triggers a “Jump-to-Time” event, instantly moving the timeline playhead to the keyframe’s timestamp.</p></li>
<li><p><strong>Visual Feedback</strong>: Pinned keyframes glow <strong>Red</strong> (#E74C3C).</p></li>
<li><p><strong>Scrub-to-Edit</strong>: While pinned, scrubbing the timeline moves the keyframe itself through time.</p></li>
<li><p><strong>Live Feedback</strong>: The keyframe’s date label updates in real-time as the playhead is dragged.</p></li>
<li><p><strong>Commit</strong>: Clicking the icon again commits the new timestamp, re-sorting the keyframe list.</p></li>
</ul>
</li>
<li><p><strong>Keyframe Deletion</strong>:</p>
<ul>
<li><p><strong>Action</strong>: Clicking the <strong>Red “✕” icon</strong> (right) requests deletion.</p></li>
<li><p><strong>Command Pattern</strong>: Executed via <code class="docutils literal notranslate"><span class="pre">DeleteKeyframeCommand</span></code> with full Undo/Redo support.</p></li>
<li><p><strong>Self-Cleanup</strong>: If a deletion leaves fewer than 2 keyframes, the entire trajectory record is automatically removed from the database to maintain data integrity.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Smart Label Scaling</strong>:</p>
<ul>
<li><p>Keyframe date labels dynamically scale with zoom but are constrained between <strong>8pt</strong> and <strong>10pt</strong>.</p></li>
<li><p>Labels are pixel-aligned directly below markers for consistent legibility.</p></li>
</ul>
</li>
<li><p><strong>Time Precision &amp; Hardening</strong>:</p>
<ul>
<li><p><strong>Precision Standard</strong>: All internal playhead calculations are now rounded to <strong>4 decimal places</strong>.</p></li>
<li><p><strong>Consistency</strong>: Rounding is applied during active scrubbing and authoritative mouse release in <code class="docutils literal notranslate"><span class="pre">TimelineView</span></code>, and enforced at the input level in <code class="docutils literal notranslate"><span class="pre">MapWidget</span></code>.</p></li>
<li><p><strong>Benefit</strong>: Eliminates floating-point drift and “jitter” in marker positions during rapid playhead interaction.</p></li>
</ul>
</li>
<li><p><strong>Playhead Persistence</strong> (New):</p>
<ul>
<li><p><strong>State Saving</strong>: The playhead time is now persisted across application restarts.</p></li>
<li><p><strong>Triggers</strong>: Time is saved on <strong>Drag Release</strong> (scrubbing), <strong>Playback Stop</strong>, and <strong>Application Exit</strong> (robust backup).</p></li>
<li><p><strong>Restoration</strong>: The app automatically restores the timeline to the last active moment on launch.</p></li>
</ul>
</li>
<li><p><strong>Draft Mode &amp; Visual Feedback</strong> (New):</p>
<ul>
<li><p><strong>Draft Indicator</strong>: A distinct “Draft Mode” (Amber) is triggered when a marker is dragged but not committed.</p></li>
<li><p><strong>Visual Separator</strong>: The Toolbar status and Map Overlay explicitly state the current mode (Normal vs. Draft vs. Clock).</p></li>
<li><p><strong>Snap-Back Logic</strong>:</p>
<ul>
<li><p><strong>Selection Change</strong>: Selecting another item destroys the transient buffer, snapping the marker back.</p></li>
<li><p><strong>Esc Key</strong>: Pressing Esc deselects the item and forces a snap-back.</p></li>
<li><p><strong>Scrubbing</strong>: Moving the timeline enforces authority, clearing the draft.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="core-component-stability-refactoring">
<h3>Core Component Stability &amp; Refactoring<a class="headerlink" href="#core-component-stability-refactoring" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>TimelineView Hardening</strong>:</p>
<ul>
<li><p>Refactored “magic number” layout constants into unified, named configurations for better maintainability.</p></li>
<li><p>Significantly improved playhead selectability with dynamic hitbox scaling that responds to zoom level.</p></li>
</ul>
</li>
<li><p><strong>Test Coverage Enhancement</strong>:</p>
<ul>
<li><p>Expanded the unit test suite with 18+ new tests for <code class="docutils literal notranslate"><span class="pre">TimelineView</span></code> helpers, including lane calculations, zoom transforms, and date-to-pixel mapping.</p></li>
<li><p>Total trajectory-related test coverage now ensures stability against regressions in interpolation and coordinate transformation logic.</p></li>
</ul>
</li>
</ul>
</section>
<section id="gaps-next-steps">
<h3>Gaps &amp; Next Steps<a class="headerlink" href="#gaps-next-steps" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Recording Mode</strong>: The “Live Puppeteering” logic (Phase 8.1) for recording real-time mouse movements is not yet implemented.</p></li>
<li><p><strong>Bezier Interpolation</strong>: Current interpolation is strictly linear; Bezier support (Phase 5.2) remains a roadmap item.</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="the-chronological-paradox-architectural-and-interaction-patterns-for-state-persistence-in-temporal-cartesian-interfaces">
<h2>14. The Chronological Paradox: Architectural and Interaction Patterns for State Persistence in Temporal Cartesian Interfaces<a class="headerlink" href="#the-chronological-paradox-architectural-and-interaction-patterns-for-state-persistence-in-temporal-cartesian-interfaces" title="Link to this heading">¶</a></h2>
<section id="introduction-the-gulf-of-execution-in-non-linear-time">
<h3>14.1 Introduction: The Gulf of Execution in Non-Linear Time<a class="headerlink" href="#introduction-the-gulf-of-execution-in-non-linear-time" title="Link to this heading">¶</a></h3>
<p>The interaction design of temporal interfaces—specifically those governing the animation of spatial markers on Cartesian planes—represents one of the most sophisticated challenges in Human-Computer Interaction (HCI). The user query highlights a fundamental friction point inherent to Non-Linear Editing (NLE) systems: the conflict between the Recorded State, defined by the deterministic interpolation of the evaluation graph, and the Transient State, generated by the user’s immediate manipulation of the viewport.</p>
<p>This report analyzes a specific solution proposed by the user: a Hybrid Static/Buffer Model. In this model, manipulating a marker “outside” a keyframe range affects its global static position, while manipulating it “inside” a range creates a temporary, scrubbable “transient” keyframe set that persists until explicitly committed.</p>
<p>This document validates this workflow against industry standards, specifically drawing parallels to Buffer Curves in Autodesk Maya, Animation Layers in MotionBuilder, and Additive Animation logic in game engines.</p>
<section id="the-phenomenology-of-the-snap-back">
<h4>14.1.1 The Phenomenology of the “Snap Back”<a class="headerlink" href="#the-phenomenology-of-the-snap-back" title="Link to this heading">¶</a></h4>
<p>The “snap back” occurs because standard NLE architectures prioritize the timeline’s authority over the user’s input buffer. When the playhead moves, the system recalculates the scene based on the graph, discarding any “unsaved” values. The user’s proposed model resolves this by creating a Temporary Edit Session—a state where the “Transient Value” temporarily overrides the “Recorded Value” during scrubbing, bridging the gap between exploration and commitment.</p>
</section>
</section>
<section id="the-hybrid-static-buffer-architecture">
<h3>14.2 The Hybrid Static/Buffer Architecture<a class="headerlink" href="#the-hybrid-static-buffer-architecture" title="Link to this heading">¶</a></h3>
<p>The user’s proposed workflow divides the timeline into two distinct interaction zones. This section deconstructs that logic using established animation theory.</p>
<section id="zone-1-outside-keyframe-range-the-static-base">
<h4>14.2.1 Zone 1: Outside Keyframe Range (The Static Base)<a class="headerlink" href="#zone-1-outside-keyframe-range-the-static-base" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>User Input</strong>: “Outside the range the position is undefined by key frames, it is just an arbitrary position.”</p>
<ul>
<li><p>In professional animation terms, this is the Base Layer or Setup Mode.</p></li>
</ul>
</li>
<li><p><strong>Concept</strong>: When the playhead is outside the influence of an active F-Curve (or before/after the animation clip), the object falls back to its static transform properties.</p></li>
<li><p><strong>Behavior</strong>: Moving the marker here does not create a keyframe. Instead, it updates the Global Offset or Root Transform of the object.</p></li>
<li><p><strong>Technical Precedent</strong>: This mirrors the behavior in MotionBuilder where editing on the “BaseAnimation” layer shifts the entire character’s position without altering the relative animation data on layers above it.</p></li>
<li><p><strong>UX Benefit</strong>: This solves the “layout” problem. Users can reposition a marker (e.g., “Move the entire path 50 pixels East”) without having to select and move every individual keyframe.</p></li>
</ul>
</section>
<section id="zone-2-inside-keyframe-range-the-transient-buffer">
<h4>14.2.2 Zone 2: Inside Keyframe Range (The Transient Buffer)<a class="headerlink" href="#zone-2-inside-keyframe-range-the-transient-buffer" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>User Input</strong>: “Moving a marker sets a new transient keyframe. Scrubbing keeps that but dirties the keyframe set.”</p>
<ul>
<li><p>This is the core innovation of the proposed model. It creates a Non-Destructive Edit Buffer.</p></li>
</ul>
</li>
<li><p><strong>Concept</strong>: When the user manipulates a value inside a keyed range, the system does not immediately overwrite the curve. Instead, it creates a Transient Keyframe in a temporary memory buffer.</p></li>
<li><p><strong>Scrubbing Behavior</strong>: The animation engine calculates position as:
$$P(t) = Interpolation(Keyframes_{original}) + \Delta(Transient)$$
Or, in a replacement logic:
$$P(t) = Interpolation(Keyframes_{transient})$$</p></li>
<li><p><strong>Persistence</strong>: Crucially, this transient state survives the “Scrub” event. The user can scrub back and forth to see how their new (unsaved) keyframe interacts with the rest of the animation.</p></li>
<li><p><strong>Industry Validation</strong>: This is functionally identical to the Buffer Curve workflow in Autodesk Maya. In Maya, users can take a “Snapshot” of a curve, edit it, and scrub the timeline to compare the “Edited” (Transient) curve against the “Buffer” (Original) curve before swapping/committing.</p></li>
</ul>
</section>
</section>
<section id="comparative-analysis-of-proven-and-tested-interaction-models">
<h3>14.3 Comparative Analysis of “Proven and Tested” Interaction Models<a class="headerlink" href="#comparative-analysis-of-proven-and-tested-interaction-models" title="Link to this heading">¶</a></h3>
<p>To implement the user’s model effectively, we must look at how similar “Buffer” and “Commit” patterns are handled in existing software.</p>
<section id="the-buffer-curve-pattern-maya">
<h4>14.3.1 The “Buffer Curve” Pattern (Maya)<a class="headerlink" href="#the-buffer-curve-pattern-maya" title="Link to this heading">¶</a></h4>
<p>Maya allows users to edit animation curves non-destructively using buffers.</p>
<ul class="simple">
<li><p><strong>Mechanism</strong>: The user selects a curve and creates a “Buffer Snapshot.” The original curve turns gray (Ghost), and the active curve can be edited freely.</p></li>
<li><p><strong>Scrubbing</strong>: The viewport updates to show the new (transient) animation.</p></li>
<li><p><strong>Commit</strong>: The user clicks “Swap Buffer” to make the changes permanent, or reverts to the snapshot to discard them.</p></li>
<li><p><strong>Relevance</strong>: This proves that separating “Transient Edit Data” from “Committed Data” is a stable, professional workflow.</p></li>
</ul>
</section>
<section id="the-audition-mode-audio-sequencing">
<h4>14.3.2 The “Audition Mode” (Audio &amp; Sequencing)<a class="headerlink" href="#the-audition-mode-audio-sequencing" title="Link to this heading">¶</a></h4>
<p>In audio software (DAWs) and some NLEs, “Auditioning” allows users to hear/see changes without writing them.</p>
<ul class="simple">
<li><p><strong>Logic</strong>: Parameters changed during playback are “overridden” but revert once playback stops unless “Write Automation” is enabled.</p></li>
<li><p><strong>User’s Variation</strong>: The user wants the change to persist after the scrub stops (until committed). This is effectively a “Latch” mode in automation terms, but applied to a draft state.</p></li>
</ul>
</section>
<section id="the-animation-layer-pattern-unity-blender">
<h4>14.3.3 The “Animation Layer” Pattern (Unity/Blender)<a class="headerlink" href="#the-animation-layer-pattern-unity-blender" title="Link to this heading">¶</a></h4>
<p>This pattern uses additive logic to handle the “Transient Keyframe.”</p>
<ul class="simple">
<li><p><strong>Mechanism</strong>: When the user moves the marker inside the range, the system effectively spawns a hidden Additive Animation Layer.</p></li>
<li><p><strong>Math</strong>: The specific move is stored as a $+ \Delta(x,y)$ on this layer.</p></li>
<li><p><strong>Scrubbing</strong>: The system sums the Base Track + The Additive Layer.</p></li>
<li><p><strong>Commit</strong>: Clicking “Commit” flattens (bakes) the additive layer down into the Base Track.</p></li>
</ul>
</section>
</section>
<section id="proposed-ux-framework-the-draft-commit-workflow">
<h3>14.4 Proposed UX Framework: The “Draft &amp; Commit” Workflow<a class="headerlink" href="#proposed-ux-framework-the-draft-commit-workflow" title="Link to this heading">¶</a></h3>
<p>Based on the research and the user’s guiding input, here is the recommended specification for the UI/UX.</p>
<section id="the-dirty-state-visualization">
<h4>14.4.1 The “Dirty” State Visualization<a class="headerlink" href="#the-dirty-state-visualization" title="Link to this heading">¶</a></h4>
<p>When a user moves a marker inside a keyframe range, the interface must explicitly signal that the timeline has entered a Draft/Dirty State.</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>State</p></th>
<th class="head text-left"><p>Visual Indicator</p></th>
<th class="head text-left"><p>Data Status</p></th>
<th class="head text-left"><p>Scrub Behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Clean</strong></p></td>
<td class="text-left"><p>White/Grey Keyframes</p></td>
<td class="text-left"><p>Read from Graph</p></td>
<td class="text-left"><p>Standard Interpolation</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Draft (Transient)</strong></p></td>
<td class="text-left"><p>Amber/Yellow Path &amp; Keyframes</p></td>
<td class="text-left"><p>Read from Buffer</p></td>
<td class="text-left"><p>Persists (User’s Requirement)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Committed</strong></p></td>
<td class="text-left"><p>Blue/Red Keyframes</p></td>
<td class="text-left"><p>Written to Graph</p></td>
<td class="text-left"><p>Standard Interpolation</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>Ghosting</strong>: To prevent disorientation, the system should display a Ghost of the original path (the “Snap Back” destination) as a faint dotted line. This gives the user confidence that their original data is safe.</p></li>
</ul>
</section>
<section id="the-interaction-logic">
<h4>14.4.2 The Interaction Logic<a class="headerlink" href="#the-interaction-logic" title="Link to this heading">¶</a></h4>
<p><strong>Outside the Range (Setup Mode)</strong></p>
<ul class="simple">
<li><p><strong>Action</strong>: User drags marker at $t &lt; Start$ or $t &gt; End$.</p></li>
<li><p><strong>System</strong>: Updates Object.BasePosition.</p></li>
<li><p><strong>Visual</strong>: The entire animation path shifts rigidly. No keyframes are added.</p></li>
<li><p><strong>Feedback</strong>: “Global Offset Applied.”</p></li>
</ul>
<p><strong>Inside the Range (Draft Mode)</strong></p>
<ul class="simple">
<li><p><strong>Action</strong>: User drags marker at $t_{current}$.</p></li>
<li><p><strong>System</strong>:</p>
<ol class="arabic simple">
<li><p>Checks if DraftBuffer exists. If not, creates one as a copy of ActiveCurve.</p></li>
<li><p>Inserts Key_{transient} at $t_{current}$ into DraftBuffer.</p></li>
<li><p>Sets Renderer.Source = DraftBuffer.</p></li>
</ol>
</li>
<li><p><strong>Visual</strong>:</p>
<ul>
<li><p>The marker path turns Amber.</p></li>
<li><p>A “Commit” button (Checkmark) and “Discard” button (X) appear near the marker or timeline.</p></li>
<li><p><strong>Ghost</strong>: The original path remains visible (Grey/Transparent).</p></li>
</ul>
</li>
<li><p><strong>Scrubbing</strong>: The user scrubs. The marker follows the Amber path (the Draft). The Grey path (Original) stays put.</p></li>
</ul>
</section>
<section id="the-commit-action">
<h4>14.4.3 The “Commit” Action<a class="headerlink" href="#the-commit-action" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>Action</strong>: User clicks “Commit.”</p></li>
<li><p><strong>System</strong>:</p>
<ol class="arabic simple">
<li><p>ActiveCurve = DraftBuffer.</p></li>
<li><p>DraftBuffer = null.</p></li>
<li><p>Renderer.Source = ActiveCurve.</p></li>
</ol>
</li>
<li><p><strong>Visual</strong>: Amber path turns standard color. Ghost disappears. “Commit” button vanishes.</p></li>
</ul>
</section>
</section>
<section id="technical-considerations">
<h3>14.5 Technical Considerations<a class="headerlink" href="#technical-considerations" title="Link to this heading">¶</a></h3>
<section id="handling-transient-data">
<h4>14.5.1 Handling “Transient” Data<a class="headerlink" href="#handling-transient-data" title="Link to this heading">¶</a></h4>
<p>To support scrubbing without “snapping back,” the application must maintain a Secondary State Object for the active selection.</p>
<ul class="simple">
<li><p><strong>Reference</strong>: This is similar to the EditorCurveBinding in Unity or the F-Curve Modifier stack in Blender.</p></li>
<li><p><strong>Implementation</strong>: The “Scrub” event listener usually queries AnimationEngine.evaluate(time). It must be patched to query DraftEngine.evaluate(time) if isDirty == true.</p></li>
</ul>
</section>
<section id="auto-keying-vs-explicit-commit">
<h4>14.5.2 Auto-Keying vs. Explicit Commit<a class="headerlink" href="#auto-keying-vs-explicit-commit" title="Link to this heading">¶</a></h4>
<p>The user requested a Button to Commit. This is an “Explicit Save” pattern.</p>
<ul class="simple">
<li><p><strong>Pros</strong>: Prevents accidental destruction of carefully tuned animation curves.</p></li>
<li><p><strong>Cons</strong>: Requires an extra click.</p></li>
<li><p><strong>Recommendation</strong>: Offer a “Auto-Commit” toggle in settings for power users, but default to the Explicit Button to solve the “Snap Back” anxiety.</p></li>
</ul>
</section>
</section>
<section id="summary-of-recommendations">
<h3>14.6 Summary of Recommendations<a class="headerlink" href="#summary-of-recommendations" title="Link to this heading">¶</a></h3>
<p>To build the solution geared to your specific input:</p>
<ol class="arabic simple">
<li><p><strong>Adopt “Buffer Curve” Architecture</strong>: Treat the “Inside Range” edits as a temporary layer (Draft) that overlays the original data. This allows the scrubbing persistence you require.</p></li>
<li><p><strong>Implement Visual Ghosting</strong>: Always show the “Original” position (Ghost) when a “Transient” keyframe is active. This explains the relationship between the Draft and the Saved state.</p></li>
<li><p><strong>Differentiate “Static” vs. “Keyed” Moves</strong>: Explicitly handle “Outside Range” moves as global offsets (changing the root transform) rather than adding keys. This aligns with the “Setup vs. Animate” mode distinction.</p></li>
<li><p><strong>Floating Commit UI</strong>: Place the “Commit/Discard” controls directly in the viewport near the modified marker to reduce mouse travel and reinforce the “Draft” metaphor.</p></li>
</ol>
<p>This approach transforms the “Snap Back” bug into a powerful Non-Destructive Versioning Feature, giving users the freedom to experiment (“audition”) without fear of data loss.</p>
</section>
<section id="works-cited">
<h3>Works cited<a class="headerlink" href="#works-cited" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Animation Layers - Maya - Autodesk product documentation, accessed on January 7, 2026, https://help.autodesk.com/view/MAYAUL/2024/ENU/?guid=GUID-5C202CB8-EB3C-4ADE-B203-5F93A9FD9104</p></li>
<li><p>NLA Additive Animation Layers: (Add/Subtract/Multiply) - Blender Artists Community, accessed on January 7, 2026, https://blenderartists.org/t/nla-additive-animation-layers-add-subtract-multiply/1100149</p></li>
<li><p>Saving - Primer Design System, accessed on January 7, 2026, https://primer.style/product/ui-patterns/saving/</p></li>
</ul>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Christian Mintert
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">ProjektKraken: Temporal Map Markers</a><ul>
<li><a class="reference internal" href="#architectural-specification-and-implementation-strategy">Architectural Specification and Implementation Strategy</a></li>
<li><a class="reference internal" href="#executive-summary-the-fourth-dimension-in-digital-cartography">1. Executive Summary: The Fourth Dimension in Digital Cartography</a></li>
<li><a class="reference internal" href="#theoretical-framework-and-core-vision">2. Theoretical Framework and Core Vision</a><ul>
<li><a class="reference internal" href="#the-limitations-of-static-cartography">2.1 The Limitations of Static Cartography</a></li>
<li><a class="reference internal" href="#the-temporal-coordinate-system">2.2 The Temporal Coordinate System</a></li>
<li><a class="reference internal" href="#core-use-case-analysis">2.3 Core Use Case Analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-architecture-and-storage-models">3. Data Architecture and Storage Models</a><ul>
<li><a class="reference internal" href="#the-temporal-json-schema">3.1 The Temporal JSON Schema</a></li>
<li><a class="reference internal" href="#keyframe-storage-and-retrieval-efficiency">3.2 Keyframe Storage and Retrieval Efficiency</a><ul>
<li><a class="reference internal" href="#ogc-mf-json-database-storage-format">3.2.1 OGC MF-JSON Database Storage Format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calendar-integration-mapping-t-to-dates">3.3 Calendar Integration: Mapping $t$ to Dates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-rendering-pipeline-qt-graphics-view-framework">4. The Rendering Pipeline: Qt Graphics View Framework</a><ul>
<li><a class="reference internal" href="#the-scene-graph-qgraphicsscene">4.1 The Scene Graph (QGraphicsScene)</a></li>
<li><a class="reference internal" href="#the-viewport-qgraphicsview">4.2 The Viewport (QGraphicsView)</a></li>
<li><a class="reference internal" href="#the-temporal-marker-item-qgraphicsitem">4.3 The Temporal Marker Item (QGraphicsItem)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#algorithmic-core-interpolation-and-trajectory">5. Algorithmic Core: Interpolation and Trajectory</a><ul>
<li><a class="reference internal" href="#linear-interpolation-lerp">5.1 Linear Interpolation (Lerp)</a></li>
<li><a class="reference internal" href="#bezier-interpolation-organic-movement">5.2 Bezier Interpolation (Organic Movement)</a></li>
<li><a class="reference internal" href="#region-animation-polygon-morphing">5.3 Region Animation (Polygon Morphing)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#time-management-architecture">6. Time Management Architecture</a><ul>
<li><a class="reference internal" href="#the-master-clock-controller">6.1 The Master Clock Controller</a></li>
<li><a class="reference internal" href="#handling-time-skips-and-non-linear-access">6.2 Handling “Time Skips” and Non-Linear Access</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-interface-the-timeline-widget">7. User Interface: The Timeline Widget</a><ul>
<li><a class="reference internal" href="#architecture-of-the-timeline">7.1 Architecture of the Timeline</a></li>
<li><a class="reference internal" href="#synchronization-logic">7.2 Synchronization Logic</a></li>
<li><a class="reference internal" href="#zoom-and-pan-on-the-time-axis">7.3 Zoom and Pan on the Time Axis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interaction-design-the-nle-on-map">8. Interaction Design: The “NLE on Map”</a><ul>
<li><a class="reference internal" href="#live-puppeteering-recording-mode">8.1 Live Puppeteering (Recording Mode)</a></li>
<li><a class="reference internal" href="#motion-path-visualization-and-editing">8.2 Motion Path Visualization and Editing</a></li>
<li><a class="reference internal" href="#selection-challenges-in-a-dynamic-scene">8.3 Selection Challenges in a Dynamic Scene</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-engineering-rendering-at-scale">9. Performance Engineering: Rendering at Scale</a><ul>
<li><a class="reference internal" href="#optimizing-the-scene-graph">9.1 Optimizing the Scene Graph</a></li>
<li><a class="reference internal" href="#the-opengl-viewport-solution">9.2 The OpenGL Viewport Solution</a></li>
<li><a class="reference internal" href="#level-of-detail-lod">9.3 Level of Detail (LOD)</a></li>
<li><a class="reference internal" href="#batching-updates">9.4 Batching Updates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-features-and-future-roadmap">10. Advanced Features and Future Roadmap</a><ul>
<li><a class="reference internal" href="#ghost-trails-motion-history">10.1 Ghost Trails (Motion History)</a></li>
<li><a class="reference internal" href="#visibility-and-existence-intervals">10.2 Visibility and Existence Intervals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-roadmap">11. Implementation Roadmap</a></li>
<li><a class="reference internal" href="#comparison-of-optimization-techniques">12. Comparison of Optimization Techniques</a></li>
<li><a class="reference internal" href="#current-implementation-status-jan-2026">13. Current Implementation Status (Jan 2026)</a><ul>
<li><a class="reference internal" href="#completed-groundwork">Completed Groundwork</a></li>
<li><a class="reference internal" href="#marker-visualization-ui">Marker Visualization &amp; UI</a></li>
<li><a class="reference internal" href="#interaction-visualization">Interaction &amp; Visualization</a></li>
<li><a class="reference internal" href="#core-component-stability-refactoring">Core Component Stability &amp; Refactoring</a></li>
<li><a class="reference internal" href="#gaps-next-steps">Gaps &amp; Next Steps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-chronological-paradox-architectural-and-interaction-patterns-for-state-persistence-in-temporal-cartesian-interfaces">14. The Chronological Paradox: Architectural and Interaction Patterns for State Persistence in Temporal Cartesian Interfaces</a><ul>
<li><a class="reference internal" href="#introduction-the-gulf-of-execution-in-non-linear-time">14.1 Introduction: The Gulf of Execution in Non-Linear Time</a><ul>
<li><a class="reference internal" href="#the-phenomenology-of-the-snap-back">14.1.1 The Phenomenology of the “Snap Back”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-hybrid-static-buffer-architecture">14.2 The Hybrid Static/Buffer Architecture</a><ul>
<li><a class="reference internal" href="#zone-1-outside-keyframe-range-the-static-base">14.2.1 Zone 1: Outside Keyframe Range (The Static Base)</a></li>
<li><a class="reference internal" href="#zone-2-inside-keyframe-range-the-transient-buffer">14.2.2 Zone 2: Inside Keyframe Range (The Transient Buffer)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#comparative-analysis-of-proven-and-tested-interaction-models">14.3 Comparative Analysis of “Proven and Tested” Interaction Models</a><ul>
<li><a class="reference internal" href="#the-buffer-curve-pattern-maya">14.3.1 The “Buffer Curve” Pattern (Maya)</a></li>
<li><a class="reference internal" href="#the-audition-mode-audio-sequencing">14.3.2 The “Audition Mode” (Audio &amp; Sequencing)</a></li>
<li><a class="reference internal" href="#the-animation-layer-pattern-unity-blender">14.3.3 The “Animation Layer” Pattern (Unity/Blender)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#proposed-ux-framework-the-draft-commit-workflow">14.4 Proposed UX Framework: The “Draft &amp; Commit” Workflow</a><ul>
<li><a class="reference internal" href="#the-dirty-state-visualization">14.4.1 The “Dirty” State Visualization</a></li>
<li><a class="reference internal" href="#the-interaction-logic">14.4.2 The Interaction Logic</a></li>
<li><a class="reference internal" href="#the-commit-action">14.4.3 The “Commit” Action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-considerations">14.5 Technical Considerations</a><ul>
<li><a class="reference internal" href="#handling-transient-data">14.5.1 Handling “Transient” Data</a></li>
<li><a class="reference internal" href="#auto-keying-vs-explicit-commit">14.5.2 Auto-Keying vs. Explicit Commit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary-of-recommendations">14.6 Summary of Recommendations</a></li>
<li><a class="reference internal" href="#works-cited">Works cited</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=70f82a29"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>