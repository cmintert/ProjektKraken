<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="Multi-Provider LLM Integration Guide" href="LLM_INTEGRATION.html"><link rel="prev" title="Security Best Practices" href="SECURITY.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Semantic Search in ProjektKraken - Project Kraken 0.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-brand-primary: #7C3AED;
  --color-brand-content: #7C3AED;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #A78BFA;
  --color-brand-content: #A78BFA;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #A78BFA;
  --color-brand-content: #A78BFA;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Project Kraken 0.4.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">Project Kraken 0.4.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="WIKI_LINKING.html">ID-Based Wiki Linking Implementation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAP_USAGE_EXAMPLES.html">Map System Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="LONGFORM.html">Longform Document Feature</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="DATABASE.html">Database Architecture and Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEVELOPMENT.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="SCHEMA_REFERENCE.html">Database Schema Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="SECURITY.html">Security Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Semantic Search in ProjektKraken</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLM_INTEGRATION.html">Multi-Provider LLM Integration Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="TAG_MIGRATION_GUIDE.html">Tag Normalization Migration Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">src</a><input aria-label="Toggle navigation of src" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="app.html">app package</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">cli package</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html">commands package</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">core package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="gui.html">gui package</a><input aria-label="Toggle navigation of gui package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="gui.widgets.html">gui.widgets package</a></li>
<li class="toctree-l3"><a class="reference internal" href="gui.dialogs.html">gui.dialogs package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html">services package</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/SEMANTIC_SEARCH.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="semantic-search-in-projektkraken">
<h1>Semantic Search in ProjektKraken<a class="headerlink" href="#semantic-search-in-projektkraken" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>ProjektKraken includes a powerful local-first semantic search system that enables natural language queries across your world’s entities and events. The system uses embeddings to understand the meaning of your content, allowing you to find related items even when they don’t share exact keywords.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Local-First</strong>: All embeddings are generated and stored locally, with no external services required</p></li>
<li><p><strong>LM Studio Integration</strong>: Primary support for LM Studio as the embedding provider</p></li>
<li><p><strong>Flexible Provider Support</strong>: Optional fallback to sentence-transformers</p></li>
<li><p><strong>Deterministic Indexing</strong>: Reproducible embeddings with text hashing to detect changes</p></li>
<li><p><strong>Comprehensive Attribute Coverage</strong>: Indexes all custom attributes, not just predefined fields</p></li>
<li><p><strong>Efficient Storage</strong>: Unit-normalized vectors with SQLite BLOB storage</p></li>
<li><p><strong>Model Management</strong>: Support for multiple models with proper filtering</p></li>
<li><p><strong>CLI and Worker Integration</strong>: Batch indexing via CLI or async indexing via background worker</p></li>
</ul>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">¶</a></h2>
<section id="data-model">
<h3>Data Model<a class="headerlink" href="#data-model" title="Link to this heading">¶</a></h3>
<p>The semantic search system adds a single <code class="docutils literal notranslate"><span class="pre">embeddings</span></code> table to the database:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">embeddings</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">object_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">        </span><span class="c1">-- &#39;entity&#39; | &#39;event&#39;</span>
<span class="w">  </span><span class="n">object_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">          </span><span class="c1">-- FK to entities/events</span>
<span class="w">  </span><span class="n">model</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">              </span><span class="c1">-- e.g., &#39;lmstudio:bge-small-en&#39;</span>
<span class="w">  </span><span class="n">vector</span><span class="w"> </span><span class="nb">BLOB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">             </span><span class="c1">-- Normalized float32 vector</span>
<span class="w">  </span><span class="n">vector_dim</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">      </span><span class="c1">-- Embedding dimension (384, 768, etc.)</span>
<span class="w">  </span><span class="n">text_snippet</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                </span><span class="c1">-- Full text that was embedded</span>
<span class="w">  </span><span class="n">text_hash</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                   </span><span class="c1">-- SHA-256 for change detection</span>
<span class="w">  </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;{}&#39;</span><span class="p">,</span><span class="w">       </span><span class="c1">-- name, type, tags, etc.</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">uq_embeddings_obj_model</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">embeddings</span><span class="p">(</span><span class="n">object_type</span><span class="p">,</span><span class="w"> </span><span class="n">object_id</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
</pre></div>
</div>
<p>Key features:</p>
<ul class="simple">
<li><p><strong>UNIQUE constraint</strong>: Prevents duplicate embeddings per object/model combination</p></li>
<li><p><strong>text_hash</strong>: Enables skip-on-unchanged optimization during reindexing</p></li>
<li><p><strong>metadata JSON</strong>: Stores rich context for query results without additional joins</p></li>
</ul>
</section>
<section id="text-extraction">
<h3>Text Extraction<a class="headerlink" href="#text-extraction" title="Link to this heading">¶</a></h3>
<p>Text is built deterministically from each object:</p>
<p><strong>For Entities:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">Type</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span>
<span class="n">Tags</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">tag1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tag2</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">)</span>
<span class="n">Description</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">attr1</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">value1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">attr2</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">value2</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p><strong>For Events:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">Type</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lore_date</span><span class="o">&gt;</span>
<span class="n">Duration</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lore_duration</span><span class="o">&gt;</span>
<span class="n">Tags</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">tag1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tag2</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">)</span>
<span class="n">Description</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">attr1</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">value1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">attr2</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">value2</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p><strong>Attributes</strong> are:</p>
<ul class="simple">
<li><p>Sorted alphabetically by key for determinism</p></li>
<li><p>Nested dicts/lists are JSON-serialized with <code class="docutils literal notranslate"><span class="pre">sort_keys=True</span></code></p></li>
<li><p>Non-ASCII characters preserved (<code class="docutils literal notranslate"><span class="pre">ensure_ascii=False</span></code>)</p></li>
</ul>
</section>
<section id="attribute-exclusion">
<h3>Attribute Exclusion<a class="headerlink" href="#attribute-exclusion" title="Link to this heading">¶</a></h3>
<p>Attributes can be excluded from the search index to prevent internal metadata or sensitive information from affecting search results.</p>
<ol class="arabic simple">
<li><p><strong>Internal Attributes</strong>: Any attribute key starting with an underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>) is automatically excluded (e.g., <code class="docutils literal notranslate"><span class="pre">_longform</span></code>, <code class="docutils literal notranslate"><span class="pre">_internal_id</span></code>).</p></li>
<li><p><strong>User-Configured Exclusions</strong>: Users can specify a list of additional attribute keys to exclude via the “Excluded Attributes” field in the AI Search Panel.</p></li>
</ol>
</section>
<section id="embedding-providers">
<h3>Embedding Providers<a class="headerlink" href="#embedding-providers" title="Link to this heading">¶</a></h3>
<section id="lm-studio-provider-primary">
<h4>LM Studio Provider (Primary)<a class="headerlink" href="#lm-studio-provider-primary" title="Link to this heading">¶</a></h4>
<p>Uses the LM Studio API endpoint for embeddings:</p>
<p><strong>Configuration:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">EMBED_PROVIDER</span><span class="o">=</span><span class="s2">&quot;lmstudio&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LMSTUDIO_EMBED_URL</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080/v1/embeddings&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LMSTUDIO_MODEL</span><span class="o">=</span><span class="s2">&quot;bge-small-en&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LMSTUDIO_API_KEY</span><span class="o">=</span><span class="s2">&quot;optional-key&quot;</span><span class="w">  </span><span class="c1"># Optional</span>
</pre></div>
</div>
<p><strong>Request Format:</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="err">POST</span><span class="w"> </span><span class="err">/v</span><span class="mi">1</span><span class="err">/embeddi</span><span class="kc">n</span><span class="err">gs</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;text 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;text 2&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bge-small-en&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Response Format:</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;embedding&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.02</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;embedding&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.03</span><span class="p">,</span><span class="w"> </span><span class="mf">0.07</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">]}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="sentence-transformers-provider-fallback">
<h4>Sentence-Transformers Provider (Fallback)<a class="headerlink" href="#sentence-transformers-provider-fallback" title="Link to this heading">¶</a></h4>
<p>Uses the <code class="docutils literal notranslate"><span class="pre">sentence-transformers</span></code> library for local embeddings without an external server:</p>
<p><strong>Configuration:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">EMBED_PROVIDER</span><span class="o">=</span><span class="s2">&quot;sentence-transformers&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LMSTUDIO_MODEL</span><span class="o">=</span><span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="w">  </span><span class="c1"># Reuses env var</span>
</pre></div>
</div>
<p>Requires: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sentence-transformers</span></code></p>
</section>
</section>
<section id="vector-operations">
<h3>Vector Operations<a class="headerlink" href="#vector-operations" title="Link to this heading">¶</a></h3>
<p><strong>Normalization:</strong>
All vectors are normalized to unit length before storage, enabling:</p>
<ul class="simple">
<li><p>Fast dot-product similarity (equivalent to cosine similarity)</p></li>
<li><p>Simpler query math</p></li>
<li><p>Consistent scoring</p></li>
</ul>
<p><strong>Serialization:</strong>
Vectors are stored as float32 BLOB for:</p>
<ul class="simple">
<li><p>Compact storage (4 bytes per dimension)</p></li>
<li><p>Fast deserialization with <code class="docutils literal notranslate"><span class="pre">numpy.frombuffer</span></code></p></li>
<li><p>Native NumPy compatibility</p></li>
</ul>
<p><strong>Similarity Search:</strong>
Uses dot product on normalized vectors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">similarity</span> <span class="o">=</span> <span class="n">query_vector</span> <span class="err">·</span> <span class="n">document_vector</span>
</pre></div>
</div>
<p><strong>Top-K Selection:</strong>
Streaming min-heap approach to limit peak memory during queries.</p>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<section id="cli">
<h3>CLI<a class="headerlink" href="#cli" title="Link to this heading">¶</a></h3>
<section id="rebuild-index">
<h4>Rebuild Index<a class="headerlink" href="#rebuild-index" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rebuild entire index</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>rebuild<span class="w"> </span>--database<span class="w"> </span>world.kraken

<span class="c1"># Index only entities</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>rebuild<span class="w"> </span>--database<span class="w"> </span>world.kraken<span class="w"> </span>--type<span class="w"> </span>entity

<span class="c1"># Use specific provider and model</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>rebuild<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--provider<span class="w"> </span>lmstudio<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model<span class="w"> </span>bge-small-en
</pre></div>
</div>
</section>
<section id="index-single-object">
<h4>Index Single Object<a class="headerlink" href="#index-single-object" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Index an entity</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>index-object<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="w"> </span>entity<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--id<span class="w"> </span>&lt;entity-uuid&gt;

<span class="c1"># Index an event</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>index-object<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="w"> </span>event<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--id<span class="w"> </span>&lt;event-uuid&gt;
</pre></div>
</div>
</section>
<section id="query">
<h4>Query<a class="headerlink" href="#query" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic query</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>query<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--text<span class="w"> </span><span class="s2">&quot;find the wizard king&quot;</span>

<span class="c1"># Filter by type</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>query<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--text<span class="w"> </span><span class="s2">&quot;ancient elven cities&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--type<span class="w"> </span>entity

<span class="c1"># Limit results</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>query<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--text<span class="w"> </span><span class="s2">&quot;battles and conflicts&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--top-k<span class="w"> </span><span class="m">5</span>

<span class="c1"># JSON output</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>query<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--database<span class="w"> </span>world.kraken<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--text<span class="w"> </span><span class="s2">&quot;magical artifacts&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--json
</pre></div>
</div>
</section>
</section>
<section id="background-worker">
<h3>Background Worker<a class="headerlink" href="#background-worker" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DatabaseWorker</span></code> includes an <code class="docutils literal notranslate"><span class="pre">index_object</span></code> slot for async indexing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In your Qt application</span>
<span class="n">worker</span><span class="o">.</span><span class="n">index_object</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;entity&quot;</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="s2">&quot;lmstudio&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>This keeps the GUI responsive during embedding generation.</p>
</section>
<section id="python-api">
<h3>Python API<a class="headerlink" href="#python-api" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.services.db_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseService</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.services.search_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_search_service</span>

<span class="c1"># Connect to database</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseService</span><span class="p">(</span><span class="s2">&quot;world.kraken&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># Create search service</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">create_search_service</span><span class="p">(</span>
    <span class="n">db</span><span class="o">.</span><span class="n">_connection</span><span class="p">,</span>
    <span class="n">provider_name</span><span class="o">=</span><span class="s2">&quot;lmstudio&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;bge-small-en&quot;</span>
<span class="p">)</span>

<span class="c1"># Index objects</span>
<span class="n">service</span><span class="o">.</span><span class="n">index_entity</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">index_event</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span>

<span class="c1"># Rebuild entire index</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">rebuild_index</span><span class="p">(</span><span class="n">object_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">])</span>

<span class="c1"># Query</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;wizard&quot;</span><span class="p">,</span> <span class="n">object_type</span><span class="o">=</span><span class="s2">&quot;entity&quot;</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Results format:</span>
<span class="c1"># [</span>
<span class="c1">#   {</span>
<span class="c1">#     &quot;id&quot;: &quot;&lt;embedding-id&gt;&quot;,</span>
<span class="c1">#     &quot;object_type&quot;: &quot;entity&quot;,</span>
<span class="c1">#     &quot;object_id&quot;: &quot;&lt;entity-uuid&gt;&quot;,</span>
<span class="c1">#     &quot;score&quot;: 0.85,</span>
<span class="c1">#     &quot;name&quot;: &quot;Gandalf&quot;,</span>
<span class="c1">#     &quot;type&quot;: &quot;character&quot;,</span>
<span class="c1">#     &quot;metadata&quot;: {...}</span>
<span class="c1">#   },</span>
<span class="c1">#   ...</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading">¶</a></h2>
<section id="indexing-performance">
<h3>Indexing Performance<a class="headerlink" href="#indexing-performance" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Batch Processing</strong>: The rebuild command processes all objects sequentially</p></li>
<li><p><strong>Skip Unchanged</strong>: Objects with the same <code class="docutils literal notranslate"><span class="pre">text_hash</span></code> are skipped during reindex</p></li>
<li><p><strong>Network Latency</strong>: LM Studio requests are the primary bottleneck</p></li>
<li><p><strong>Database Writes</strong>: Uses upsert with UNIQUE constraint for efficiency</p></li>
</ul>
<p><strong>Typical Performance:</strong></p>
<ul class="simple">
<li><p>~100-500ms per embedding (depends on model and LM Studio config)</p></li>
<li><p>~1000 objects in 2-10 minutes for initial index</p></li>
<li><p>Subsequent reindexes are faster due to skip-on-unchanged</p></li>
</ul>
</section>
<section id="query-performance">
<h3>Query Performance<a class="headerlink" href="#query-performance" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Linear Scan</strong>: Current implementation uses linear scan for similarity</p></li>
<li><p><strong>Streaming Top-K</strong>: Limits peak memory usage</p></li>
<li><p><strong>Model Filtering</strong>: Only compares against embeddings with matching model/dimension</p></li>
</ul>
<p><strong>Typical Performance:</strong></p>
<ul class="simple">
<li><p>&lt;100ms for 1000 embeddings</p></li>
<li><p>&lt;1s for 10,000 embeddings</p></li>
<li><p>Scales linearly with index size</p></li>
</ul>
</section>
<section id="future-optimizations">
<h3>Future Optimizations<a class="headerlink" href="#future-optimizations" title="Link to this heading">¶</a></h3>
<p>For larger worlds (&gt;10,000 objects), consider:</p>
<ul class="simple">
<li><p><strong>FAISS</strong>: Approximate nearest neighbor search with GPU acceleration</p></li>
<li><p><strong>Annoy</strong>: Memory-efficient ANN index for CPU</p></li>
<li><p><strong>Chunking</strong>: Split large attributes into multiple embeddings</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">SearchService</span></code> is designed with a pluggable <code class="docutils literal notranslate"><span class="pre">VectorIndex</span></code> protocol to enable these optimizations without breaking changes.</p>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="model-selection">
<h3>Model Selection<a class="headerlink" href="#model-selection" title="Link to this heading">¶</a></h3>
<p><strong>For General Use:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bge-small-en-v1.5</span></code> (384d): Fast, good quality</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">all-MiniLM-L6-v2</span></code> (384d): Lightweight, sentence-transformers default</p></li>
</ul>
<p><strong>For Better Quality:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bge-base-en-v1.5</span></code> (768d): Larger but more accurate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e5-large-v2</span></code> (1024d): State-of-the-art quality (slower)</p></li>
</ul>
<p><strong>Trade-offs:</strong></p>
<ul class="simple">
<li><p>Larger dimensions = better quality, more storage, slower queries</p></li>
<li><p>Smaller dimensions = faster, less storage, lower quality</p></li>
</ul>
</section>
<section id="when-to-reindex">
<h3>When to Reindex<a class="headerlink" href="#when-to-reindex" title="Link to this heading">¶</a></h3>
<p>Reindex when:</p>
<ul class="simple">
<li><p>You change the embedding model</p></li>
<li><p>You add significant amounts of new content (&gt;100 objects)</p></li>
<li><p>You update many object descriptions/attributes</p></li>
</ul>
<p>You don’t need to reindex for:</p>
<ul class="simple">
<li><p>Minor description edits (hash check will detect)</p></li>
<li><p>Relation changes (not indexed)</p></li>
<li><p>Name/type changes (automatically reindexed on next rebuild)</p></li>
</ul>
</section>
<section id="query-tips">
<h3>Query Tips<a class="headerlink" href="#query-tips" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Be Specific</strong>: “elven city” better than “city”</p></li>
<li><p><strong>Use Context</strong>: “ancient battle wizard” better than “wizard”</p></li>
<li><p><strong>Filter by Type</strong>: Use <code class="docutils literal notranslate"><span class="pre">--type</span></code> to reduce noise</p></li>
<li><p><strong>Increase top-k</strong>: Default is 10, increase for broader results</p></li>
</ul>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<section id="lm-studio-connection-issues">
<h3>LM Studio Connection Issues<a class="headerlink" href="#lm-studio-connection-issues" title="Link to this heading">¶</a></h3>
<p><strong>Error:</strong> <code class="docutils literal notranslate"><span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">connect</span> <span class="pre">to</span> <span class="pre">LM</span> <span class="pre">Studio</span></code></p>
<p><strong>Solutions:</strong></p>
<ol class="arabic simple">
<li><p>Verify LM Studio is running: Check the app is open</p></li>
<li><p>Check the endpoint URL: Ensure <code class="docutils literal notranslate"><span class="pre">LMSTUDIO_EMBED_URL</span></code> is correct</p></li>
<li><p>Verify model supports embeddings: Not all models have embedding endpoints</p></li>
<li><p>Check firewall: Ensure localhost connections are allowed</p></li>
</ol>
<p><strong>Test Connection:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/v1/embeddings<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;input&quot;: [&quot;test&quot;], &quot;model&quot;: &quot;bge-small-en&quot;}&#39;</span>
</pre></div>
</div>
</section>
<section id="model-dimension-mismatch">
<h3>Model Dimension Mismatch<a class="headerlink" href="#model-dimension-mismatch" title="Link to this heading">¶</a></h3>
<p><strong>Error:</strong> Query returns no results after changing models</p>
<p><strong>Cause:</strong> Old embeddings use different dimension than new model</p>
<p><strong>Solution:</strong> Rebuild the index:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>rebuild<span class="w"> </span>--database<span class="w"> </span>world.kraken<span class="w"> </span>--model<span class="w"> </span>&lt;new-model&gt;
</pre></div>
</div>
</section>
<section id="slow-indexing">
<h3>Slow Indexing<a class="headerlink" href="#slow-indexing" title="Link to this heading">¶</a></h3>
<p><strong>Symptoms:</strong> Taking &gt;1s per object</p>
<p><strong>Solutions:</strong></p>
<ol class="arabic simple">
<li><p>Check LM Studio GPU acceleration is enabled</p></li>
<li><p>Reduce batch size (implementation detail, currently single-request)</p></li>
<li><p>Use a smaller model (e.g., 384d vs 768d)</p></li>
<li><p>Consider sentence-transformers for local processing</p></li>
</ol>
</section>
<section id="out-of-memory">
<h3>Out of Memory<a class="headerlink" href="#out-of-memory" title="Link to this heading">¶</a></h3>
<p><strong>Symptoms:</strong> Query crashes with large index</p>
<p><strong>Solutions:</strong></p>
<ol class="arabic simple">
<li><p>Reduce <code class="docutils literal notranslate"><span class="pre">top_k</span></code> parameter</p></li>
<li><p>Use model/type filtering to reduce search space</p></li>
<li><p>Upgrade to FAISS/Annoy for large indices (future enhancement)</p></li>
</ol>
</section>
</section>
<section id="security-considerations">
<h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Local-First</strong>: No data leaves your machine</p></li>
<li><p><strong>No Credentials</strong>: LM Studio runs locally, no API keys required</p></li>
<li><p><strong>Privacy</strong>: Full control over model and data</p></li>
<li><p><strong>Offline</strong>: Works without internet connection</p></li>
</ul>
</section>
<section id="migration-guide">
<h2>Migration Guide<a class="headerlink" href="#migration-guide" title="Link to this heading">¶</a></h2>
<section id="existing-databases">
<h3>Existing Databases<a class="headerlink" href="#existing-databases" title="Link to this heading">¶</a></h3>
<p>The embeddings table is created automatically via <code class="docutils literal notranslate"><span class="pre">_init_schema()</span></code> when you connect to an existing database. No manual migration required.</p>
</section>
<section id="changing-models">
<h3>Changing Models<a class="headerlink" href="#changing-models" title="Link to this heading">¶</a></h3>
<p>To switch embedding models:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set new model</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LMSTUDIO_MODEL</span><span class="o">=</span><span class="s2">&quot;new-model-name&quot;</span>

<span class="c1"># Rebuild index (this will replace old embeddings)</span>
python<span class="w"> </span>-m<span class="w"> </span>src.cli.index<span class="w"> </span>rebuild<span class="w"> </span>--database<span class="w"> </span>world.kraken
</pre></div>
</div>
<p>Old embeddings are automatically replaced due to the UNIQUE constraint on <code class="docutils literal notranslate"><span class="pre">(object_type,</span> <span class="pre">object_id,</span> <span class="pre">model)</span></code>.</p>
</section>
<section id="backup-recommendation">
<h3>Backup Recommendation<a class="headerlink" href="#backup-recommendation" title="Link to this heading">¶</a></h3>
<p>Before major reindexing operations, backup your database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>world.kraken<span class="w"> </span>world.kraken.backup
</pre></div>
</div>
<p>The embeddings table is non-destructive and can be dropped/rebuilt without affecting core data.</p>
</section>
</section>
<section id="future-enhancements">
<h2>Future Enhancements<a class="headerlink" href="#future-enhancements" title="Link to this heading">¶</a></h2>
<p>Planned improvements:</p>
<ul class="simple">
<li><p>[ ] GUI search panel with live results</p></li>
<li><p>[ ] Relation embeddings for “who caused X” queries</p></li>
<li><p>[ ] Chunked embeddings for large attribute payloads</p></li>
<li><p>[ ] FAISS integration for large worlds</p></li>
<li><p>[ ] Cross-object “Related items” suggestions</p></li>
<li><p>[ ] Embedding cache for faster reindexing</p></li>
<li><p>[ ] Parallel indexing for rebuild performance</p></li>
</ul>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>LM Studio</strong>: https://lmstudio.ai/</p></li>
<li><p><strong>BGE Models</strong>: https://huggingface.co/BAAI/bge-small-en-v1.5</p></li>
<li><p><strong>Sentence Transformers</strong>: https://www.sbert.net/</p></li>
<li><p><strong>Vector Search</strong>: https://www.pinecone.io/learn/vector-search/</p></li>
</ul>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h2>
<p>When adding semantic search features:</p>
<ol class="arabic simple">
<li><p>Keep the interface provider-agnostic</p></li>
<li><p>Add tests for new text building logic</p></li>
<li><p>Document new environment variables</p></li>
<li><p>Ensure deterministic behavior for reproducibility</p></li>
<li><p>Consider memory usage for large indices</p></li>
</ol>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="LLM_INTEGRATION.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Multi-Provider LLM Integration Guide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="SECURITY.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Security Best Practices</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Christian Mintert
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Semantic Search in ProjektKraken</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a><ul>
<li><a class="reference internal" href="#data-model">Data Model</a></li>
<li><a class="reference internal" href="#text-extraction">Text Extraction</a></li>
<li><a class="reference internal" href="#attribute-exclusion">Attribute Exclusion</a></li>
<li><a class="reference internal" href="#embedding-providers">Embedding Providers</a><ul>
<li><a class="reference internal" href="#lm-studio-provider-primary">LM Studio Provider (Primary)</a></li>
<li><a class="reference internal" href="#sentence-transformers-provider-fallback">Sentence-Transformers Provider (Fallback)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vector-operations">Vector Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#cli">CLI</a><ul>
<li><a class="reference internal" href="#rebuild-index">Rebuild Index</a></li>
<li><a class="reference internal" href="#index-single-object">Index Single Object</a></li>
<li><a class="reference internal" href="#query">Query</a></li>
</ul>
</li>
<li><a class="reference internal" href="#background-worker">Background Worker</a></li>
<li><a class="reference internal" href="#python-api">Python API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li><a class="reference internal" href="#indexing-performance">Indexing Performance</a></li>
<li><a class="reference internal" href="#query-performance">Query Performance</a></li>
<li><a class="reference internal" href="#future-optimizations">Future Optimizations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li><a class="reference internal" href="#model-selection">Model Selection</a></li>
<li><a class="reference internal" href="#when-to-reindex">When to Reindex</a></li>
<li><a class="reference internal" href="#query-tips">Query Tips</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#lm-studio-connection-issues">LM Studio Connection Issues</a></li>
<li><a class="reference internal" href="#model-dimension-mismatch">Model Dimension Mismatch</a></li>
<li><a class="reference internal" href="#slow-indexing">Slow Indexing</a></li>
<li><a class="reference internal" href="#out-of-memory">Out of Memory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations">Security Considerations</a></li>
<li><a class="reference internal" href="#migration-guide">Migration Guide</a><ul>
<li><a class="reference internal" href="#existing-databases">Existing Databases</a></li>
<li><a class="reference internal" href="#changing-models">Changing Models</a></li>
<li><a class="reference internal" href="#backup-recommendation">Backup Recommendation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#future-enhancements">Future Enhancements</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#contributing">Contributing</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=1437fa6d"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>