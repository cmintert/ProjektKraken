# Database Schema Reference

**This file is auto-generated from the DatabaseService implementation.**

Do not edit this file manually. To update the schema, modify `src/services/db_service.py` and rebuild the documentation.

## Entity Relationship Diagram

```mermaid
erDiagram
    system_meta {
        TEXT key PK
        TEXT value
    }

    entities {
        TEXT id PK
        TEXT type
        TEXT name
        TEXT description
        JSON attributes
        REAL created_at
        REAL modified_at
    }

    events {
        TEXT id PK
        TEXT type
        TEXT name
        REAL lore_date
        REAL lore_duration
        TEXT description
        JSON attributes
        REAL created_at
        REAL modified_at
    }

    relations {
        TEXT id PK
        TEXT source_id
        TEXT target_id
        TEXT rel_type
        JSON attributes
        REAL created_at
    }

    calendar_config {
        TEXT id PK
        TEXT name
        TEXT config_json
        INTEGER is_active
        REAL created_at
        REAL modified_at
    }

    maps {
        TEXT id PK
        TEXT name
        TEXT image_path
        TEXT description
        JSON attributes
        REAL created_at
        REAL modified_at
    }

    markers {
        TEXT id PK
        TEXT map_id
        TEXT object_id
        TEXT object_type
        REAL x
        REAL y
        TEXT label
        JSON attributes
        REAL created_at
        REAL modified_at
    }

    image_attachments {
        TEXT id PK
        TEXT owner_type
        TEXT owner_id
        TEXT image_rel_path
        TEXT thumb_rel_path
        TEXT caption
        INTEGER order_index
        REAL created_at
        TEXT, resolution
        TEXT source
    }

    tags {
        TEXT id PK
        TEXT name
        TEXT color
        REAL created_at
    }

    event_tags {
        TEXT event_id
        TEXT tag_id
        REAL created_at
    }

    entity_tags {
        TEXT entity_id
        TEXT tag_id
        REAL created_at
    }

    embeddings {
        TEXT id PK
        TEXT object_type
        TEXT object_id
        TEXT model
        BLOB vector
        INTEGER vector_dim
        TEXT text_snippet
        TEXT text_hash
        JSON metadata
        REAL created_at
    }

    markers }o--|| maps : "map_id"
    event_tags }o--|| events : "event_id"
    event_tags }o--|| tags : "tag_id"
    entity_tags }o--|| entities : "entity_id"
    entity_tags }o--|| tags : "tag_id"
```

## Table Definitions

### `system_meta`

| Column | Type | Constraints |
|--------|------|-------------|
| `key` | TEXT | PRIMARY KEY |
| `value` | TEXT |  |

### `entities`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `type` | TEXT | NOT NULL |
| `name` | TEXT | NOT NULL |
| `description` | TEXT |  |
| `attributes` | JSON | DEFAULT '{}' |
| `created_at` | REAL |  |
| `modified_at` | REAL |  |

### `events`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `type` | TEXT | NOT NULL |
| `name` | TEXT | NOT NULL |
| `lore_date` | REAL | NOT NULL |
| `lore_duration` | REAL | DEFAULT 0.0 |
| `description` | TEXT |  |
| `attributes` | JSON | DEFAULT '{}' |
| `created_at` | REAL |  |
| `modified_at` | REAL |  |

**Indexes:** `idx_events_date`

### `relations`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `source_id` | TEXT | NOT NULL |
| `target_id` | TEXT | NOT NULL |
| `rel_type` | TEXT | NOT NULL |
| `attributes` | JSON | DEFAULT '{}' |
| `created_at` | REAL |  |

**Indexes:** `idx_relations_source`, `idx_relations_target`

### `calendar_config`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `name` | TEXT | NOT NULL |
| `config_json` | TEXT | NOT NULL |
| `is_active` | INTEGER | DEFAULT 0 |
| `created_at` | REAL |  |
| `modified_at` | REAL |  |

### `maps`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `name` | TEXT | NOT NULL |
| `image_path` | TEXT | NOT NULL |
| `description` | TEXT |  |
| `attributes` | JSON | DEFAULT '{}' |
| `created_at` | REAL |  |
| `modified_at` | REAL |  |

### `markers`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `map_id` | TEXT | NOT NULL |
| `object_id` | TEXT | NOT NULL |
| `object_type` | TEXT | NOT NULL |
| `x` | REAL | NOT NULL |
| `y` | REAL | NOT NULL |
| `label` | TEXT |  |
| `attributes` | JSON | DEFAULT '{}' |
| `created_at` | REAL |  |
| `modified_at` | REAL |  |

**Indexes:** `idx_markers_map`

### `image_attachments`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `owner_type` | TEXT | NOT NULL |
| `owner_id` | TEXT | NOT NULL |
| `image_rel_path` | TEXT | NOT NULL |
| `thumb_rel_path` | TEXT |  |
| `caption` | TEXT |  |
| `order_index` | INTEGER | DEFAULT 0 |
| `created_at` | REAL |  |
| `resolution` | TEXT, | -- Stored as "widthxheight" or JSON [w, h] |
| `source` | TEXT |  |

### `tags`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `name` | TEXT | NOT NULL UNIQUE |
| `color` | TEXT |  |
| `created_at` | REAL | NOT NULL |

**Indexes:** `idx_tags_name`

### `event_tags`

| Column | Type | Constraints |
|--------|------|-------------|
| `event_id` | TEXT | NOT NULL |
| `tag_id` | TEXT | NOT NULL |
| `created_at` | REAL | NOT NULL |

**Indexes:** `idx_event_tags_event`, `idx_event_tags_tag`

### `entity_tags`

| Column | Type | Constraints |
|--------|------|-------------|
| `entity_id` | TEXT | NOT NULL |
| `tag_id` | TEXT | NOT NULL |
| `created_at` | REAL | NOT NULL |

**Indexes:** `idx_entity_tags_entity`, `idx_entity_tags_tag`

### `embeddings`

| Column | Type | Constraints |
|--------|------|-------------|
| `id` | TEXT | PRIMARY KEY |
| `object_type` | TEXT | NOT NULL |
| `object_id` | TEXT | NOT NULL |
| `model` | TEXT | NOT NULL |
| `vector` | BLOB | NOT NULL |
| `vector_dim` | INTEGER | NOT NULL |
| `text_snippet` | TEXT |  |
| `text_hash` | TEXT |  |
| `metadata` | JSON | DEFAULT '{}' |
| `created_at` | REAL | NOT NULL |
